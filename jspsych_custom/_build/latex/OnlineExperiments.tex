%% Generated by Sphinx.
\def\sphinxdocclass{report}
\documentclass[letterpaper,10pt,english]{sphinxmanual}
\ifdefined\pdfpxdimen
   \let\sphinxpxdimen\pdfpxdimen\else\newdimen\sphinxpxdimen
\fi \sphinxpxdimen=.75bp\relax

\PassOptionsToPackage{warn}{textcomp}
\usepackage[utf8]{inputenc}
\ifdefined\DeclareUnicodeCharacter
% support both utf8 and utf8x syntaxes
  \ifdefined\DeclareUnicodeCharacterAsOptional
    \def\sphinxDUC#1{\DeclareUnicodeCharacter{"#1}}
  \else
    \let\sphinxDUC\DeclareUnicodeCharacter
  \fi
  \sphinxDUC{00A0}{\nobreakspace}
  \sphinxDUC{2500}{\sphinxunichar{2500}}
  \sphinxDUC{2502}{\sphinxunichar{2502}}
  \sphinxDUC{2514}{\sphinxunichar{2514}}
  \sphinxDUC{251C}{\sphinxunichar{251C}}
  \sphinxDUC{2572}{\textbackslash}
\fi
\usepackage{cmap}
\usepackage[T1]{fontenc}
\usepackage{amsmath,amssymb,amstext}
\usepackage{babel}



\usepackage{times}
\expandafter\ifx\csname T@LGR\endcsname\relax
\else
% LGR was declared as font encoding
  \substitutefont{LGR}{\rmdefault}{cmr}
  \substitutefont{LGR}{\sfdefault}{cmss}
  \substitutefont{LGR}{\ttdefault}{cmtt}
\fi
\expandafter\ifx\csname T@X2\endcsname\relax
  \expandafter\ifx\csname T@T2A\endcsname\relax
  \else
  % T2A was declared as font encoding
    \substitutefont{T2A}{\rmdefault}{cmr}
    \substitutefont{T2A}{\sfdefault}{cmss}
    \substitutefont{T2A}{\ttdefault}{cmtt}
  \fi
\else
% X2 was declared as font encoding
  \substitutefont{X2}{\rmdefault}{cmr}
  \substitutefont{X2}{\sfdefault}{cmss}
  \substitutefont{X2}{\ttdefault}{cmtt}
\fi


\usepackage[Bjarne]{fncychap}
\usepackage{sphinx}

\fvset{fontsize=\small}
\usepackage{geometry}


% Include hyperref last.
\usepackage{hyperref}
% Fix anchor placement for figures with captions.
\usepackage{hypcap}% it must be loaded after hyperref.
% Set up styles of URL: it should be placed after hyperref.
\urlstyle{same}

\usepackage{sphinxmessages}
\setcounter{tocdepth}{1}



\title{Online Experiments}
\date{May 29, 2020}
\release{1.0.0}
\author{Alisdair Tullo}
\newcommand{\sphinxlogo}{\vbox{}}
\renewcommand{\releasename}{Release}
\makeindex
\begin{document}

\pagestyle{empty}
\sphinxmaketitle
\pagestyle{plain}
\sphinxtableofcontents
\pagestyle{normal}
\phantomsection\label{\detokenize{index::doc}}


\begin{center}Aarhus University, 28th\sphinxhyphen{}29th May 2020
\end{center}
\begin{center}Alisdair Tullo (\sphinxhref{mailto:alisdair@tullo.me.uk}{alisdair@tullo.me.uk})
\end{center}
Welcome to the web and jsPsych part of Online Experiments!

If you’re here for the talk introducing the concepts of the Web on 28th May,
please go to “About the Web”.

If you’re here for the talk and practical on jsPsych on 29th May, please go to
“An introduction to jsPsych”.

\sphinxhref{slides}{PDFs of slides}

\sphinxhref{otree\_help.html}{oTree impromptu notes}


\chapter{About the Web}
\label{\detokenize{web:about-the-web}}\label{\detokenize{web::doc}}
The internet is a big network of computers, all connected. Here’s a picture:

\noindent\sphinxincludegraphics[width=0.900\linewidth]{{the_internet}.jpg}

In reality there are many more, of course! Let’s think about what needs to happen
for you to see this web page. This page is on another computer \textendash{} saved on a disk
just as it would be on your computer. The other computer’s name on the
network is \sphinxstylestrong{tullo.co.uk}.


\section{Requests and responses}
\label{\detokenize{web:requests-and-responses}}
Your computer (or
phone) needs to send a request for this information. This will pass through
many other computers on the way. Once the request is received, the information
will be sent back. It doesn’t have to go the same way each time!

We refer to the computer making the request as a \sphinxstylestrong{client} and the computer
responding to it as a \sphinxstylestrong{server}. Usually servers don’t have a screen or keyboard,
they are just connected straight to the network \textendash{} that’s how they interact with
the world. They are sometimes powerful, in order to quickly handle large numbers
of requests. Other than that they are very similar to the computer on your desk,
they have files on a disk, and can run programs.


\section{HTML}
\label{\detokenize{web:html}}
When a web page is sent to your computer, it will be in HTML. This is a language
which can represent the content and structure of a page \textendash{} how text is divided,
which images will be included, and so on. To see what it looks like, you can ask
your web browser:
\begin{description}
\item[{Firefox or Chrome}] \leavevmode
Right\sphinxhyphen{}click and “View Page Source”

\item[{Internet Explorer}] \leavevmode
Right\sphinxhyphen{}click and “View Source”

\item[{Edge}] \leavevmode
Press F12 to start Developer tools, then right\sphinxhyphen{}click and “View Source”

\item[{Safari}] \leavevmode
Preferences \(\rightarrow\) Advanced and check “Show Develop menu in menu bar”
(this will be useful later, too).
You can then choose Develop \(\rightarrow\) Show Page Source

\end{description}

You’ll see that all the content of the page is in there. The extra information
in the tags help to give the document structure.

For example:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{p}{\PYGZlt{}}\PYG{n+nt}{title}\PYG{p}{\PYGZgt{}}About the Web\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{title}\PYG{p}{\PYGZgt{}}
\end{sphinxVerbatim}

This sets the text that appears in the title bar of your browser window.

To give another example, a
\sphinxhref{http://tullo.co.uk/jspsych\_aarhus/web.html}{link to this page}
looks like this:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{p}{\PYGZlt{}}\PYG{n+nt}{a} \PYG{n+na}{class}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}reference external\PYGZdq{}} \PYG{n+na}{href}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}http://tullo.co.uk/jspsych\PYGZus{}aarhus/web.html\PYGZdq{}}\PYG{p}{\PYGZgt{}}link to this page\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{a}\PYG{p}{\PYGZgt{}}
\end{sphinxVerbatim}


\section{CSS}
\label{\detokenize{web:css}}
That’s not the whole story, though. As well as the text, there also need to be
instructions on how to show it. This includes things like font, colour, line
spacing and so on.

Near the top of the page you’ll see:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{p}{\PYGZlt{}}\PYG{n+nt}{link} \PYG{n+na}{rel}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}stylesheet\PYGZdq{}} \PYG{n+na}{href}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}\PYGZus{}static/alabaster.css\PYGZdq{}} \PYG{n+na}{type}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}text/css\PYGZdq{}} \PYG{p}{/}\PYG{p}{\PYGZgt{}}
\end{sphinxVerbatim}

This tells the browser to use a stylesheet, telling it how to format the page.
Let’s take a look at it. Click on the text after \sphinxcode{\sphinxupquote{href=}} in your
“view source” window. (If that doesn’t work, use
\sphinxhref{http://tullo.co.uk/jspsych\_aarhus/\_static/alabaster.css}{this link here}).
You’ll have to scroll down!

Just after the heading “body styles”, you’ll see this:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n+nt}{a} \PYG{p}{\PYGZob{}}
    \PYG{k}{color}\PYG{p}{:} \PYG{l+m+mh}{\PYGZsh{}004B6B}\PYG{p}{;}
    \PYG{k}{text\PYGZhy{}decoration}\PYG{p}{:} \PYG{k+kc}{underline}\PYG{p}{;}
\PYG{p}{\PYGZcb{}}
\end{sphinxVerbatim}

This relates to an \sphinxcode{\sphinxupquote{a}} tag, which is a text link. Remember that the link we
saw above used a tag starting with \sphinxcode{\sphinxupquote{\textless{}a href=" ....}}.

When the web browser sees the \sphinxcode{\sphinxupquote{\textless{}a ....\textgreater{} .... \textless{}/a\textgreater{}}} it uses the information
in the relevant CSS to format the link.
\begin{description}
\item[{\sphinxcode{\sphinxupquote{color: \#004B6B;}}}] \leavevmode
is a way of specifying
a particular shade of blue. (There are easier ways for more common colours!).

\item[{\sphinxcode{\sphinxupquote{text\sphinxhyphen{}decoration: underline;}}}] \leavevmode
tells the browser to underline the text.

\end{description}

Looking back at the displayed page, you can see that the link is indeed blue
and underlined.


\section{JavaScript}
\label{\detokenize{web:javascript}}
JavaScript is a language that can be used to run a program in your web browser.
It can be used to change the contents of a page, and can respond to the user’s
actions (for example, mouse clicks or key presses).

This is important because it gives us a way to run a program inside the web
browser. Without JavaScript, the only way to interact with the user would be
by loading a different page, or loading the same page again.

This is what jsPsych uses to run the experiment. All you need to do is write
some code to describe what you what to happen in the experiment \textendash{} what
stimuli should be shown, and what kind of responses should be collected.


\section{Thanks!}
\label{\detokenize{web:thanks}}
With gratitude to the
\sphinxhref{https://tutorial.djangogirls.org/en/how\_the\_internet\_works/}{DjangoGirls intro},
for inspiration.

Internet image: By The Opte Project CC BY 2.5 (\sphinxurl{http://creativecommons.org/licenses/by/2.5} ),
via Wikimedia Commons, \sphinxhref{https://commons.wikimedia.org/wiki/File:Internet\_map\_1024.jpg}{original source here} .


\chapter{An introduction to jsPsych}
\label{\detokenize{jspsych_au:an-introduction-to-jspsych}}\label{\detokenize{jspsych_au::doc}}
jsPsych is a JavaScript framework that makes it easier to construct
presentation experiments.

\sphinxstylestrong{Credit:} If you use jsPsych, please credit its creator, Joshua R. de Leeuw.
He requests that users of jsPsych do this by citing the following paper:

\sphinxhref{https://link.springer.com/article/10.3758/s13428-014-0458-y}{de Leeuw, J. R. (2015). jsPsych: A JavaScript library for creating behavioral
experiments in a web browser. Behavior Research Methods, 47(1), 1\sphinxhyphen{}12.
doi:10.3758/s13428\sphinxhyphen{}014\sphinxhyphen{}0458\sphinxhyphen{}y}


\section{Overview}
\label{\detokenize{jspsych_au:overview}}

\subsection{Documentation and examples}
\label{\detokenize{jspsych_au:documentation-and-examples}}
Throughout this talk and the practical please keep the documentation handy.

jsPsych website: \sphinxurl{https://www.jspsych.org}

MDN (for HTML, CSS and JavaScript): \sphinxurl{https://developer.mozilla.org/}

Most of the time for HTML, CSS and JavaScript docs, typing “mdn \textless{}something\textgreater{}”
into a search engine will get you the right page. For example if I search for
\begin{quote}

mdn array
\end{quote}

the first result is:

\sphinxurl{https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global\_Objects/Array}

Also please refer to the front page where there are many examples you can
refer to. Feel free to copy these and adapt them to what you need.

Some of the examples use a test set of images of animals (\sphinxcode{\sphinxupquote{Dog1.jpg}} etc.).
If you’d like to use these you can download them from here:

\sphinxurl{https://tullo.co.uk/au/images.zip}


\subsection{How it works}
\label{\detokenize{jspsych_au:how-it-works}}
A typical jsPsych experiment will follow a sequence something like this:

1. First, the experiment is loaded from the server onto the participant’s
web browser (client). This is just like loading any other web page, so everything
you saw in the previous talk about the network, web pages, HTML, CSS and so on
applies here.

\begin{DUlineblock}{0em}
\item[] 
\end{DUlineblock}

\noindent\sphinxincludegraphics[width=0.900\linewidth]{{jspsych_how_1}.png}

\begin{DUlineblock}{0em}
\item[] 
\end{DUlineblock}

2. Now the experiment runs. This can happen entirely within the participant’s web
browser \textendash{} it may not need to talk to the server at all. (It might though, for
example to load images).

\begin{DUlineblock}{0em}
\item[] 
\end{DUlineblock}

\noindent\sphinxincludegraphics[width=0.900\linewidth]{{jspsych_how_2}.png}

\begin{DUlineblock}{0em}
\item[] 
\end{DUlineblock}

3. Finally, the experiment sends the results from the experiment back to the
server.

\begin{DUlineblock}{0em}
\item[] 
\end{DUlineblock}

\noindent\sphinxincludegraphics[width=0.900\linewidth]{{jspsych_how_3}.png}

\begin{DUlineblock}{0em}
\item[] 
\end{DUlineblock}


\subsection{What can jsPsych do?}
\label{\detokenize{jspsych_au:what-can-jspsych-do}}\begin{itemize}
\item {} 
In theory anything that your browser can do!

\item {} 
In practice, the plugins are oriented around a set of specific interactions

\item {} 
This covers lots of cases, but not everything

\item {} 
You can write your own plugins (and this is easier than you might think)

\end{itemize}


\subsection{When not to use jsPsych?}
\label{\detokenize{jspsych_au:when-not-to-use-jspsych}}\begin{itemize}
\item {} 
For \sphinxstyleemphasis{very} interactive stuff (realtime interaction) it might be better to use
something else (e.g. p5.js)

\item {} 
Not designed for multi\sphinxhyphen{}participant experiments \textendash{} use oTree or custom JavaScript
with WebSockets

\item {} 
Might be too much for some tasks, survey software is often more capable than
you think

\end{itemize}


\section{Anatomy of jsPsych experiment code}
\label{\detokenize{jspsych_au:anatomy-of-jspsych-experiment-code}}
A jsPsych experiment must contain:
\begin{itemize}
\item {} 
Definition of a series of nodes, and

\item {} 
A call to the jsPsych.init() function to start the experiment.

\end{itemize}

Let’s look at these two in turn.


\subsection{Nodes}
\label{\detokenize{jspsych_au:nodes}}
Every jsPsych experiment is a series of nodes. Most nodes show a stimulus, or a set of stimuli,
and then collect a response. Here’s an example:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kd}{var} \PYG{n+nx}{trial} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{n+nx}{type}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}html\PYGZhy{}keyboard\PYGZhy{}response\PYGZsq{}}\PYG{p}{,}
    \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}Hello world!\PYGZsq{}}
\PYG{p}{\PYGZcb{}}
\end{sphinxVerbatim}

This defines a jsPsych node, which displays the text “Hello world!” and collects
a response from the keyboard.

Every node that displays content must have a “type” field. This value
corresponds to the list of plugins on the jsPsych website. Go back to
\sphinxhref{http://www.jspsych.org/}{the jsPsych website} and click on “Plugins” for
the full list.

These plugins allow you to do different things like:
\begin{itemize}
\item {} 
Present a stimulus and collect a keyboard response

\item {} 
Present a stimulus and collect a click response (button)

\item {} 
Present a multiple choice question

\end{itemize}

and many others. You can write your own plugins to
do things that aren’t possible with default jsPsych \textendash{} this requires some
JavaScript skills but can be easier than you think depending on the task.
Often it’s possible to adapt one of the built\sphinxhyphen{}in plugins.

Each kind of node can be set up using different parameters. The name of each parameter is
the thing before the colon : in the code above. For example:

\sphinxcode{\sphinxupquote{stimulus: \textquotesingle{}Hello world!\textquotesingle{}}}

means “the value of the \sphinxcode{\sphinxupquote{stimulus}} parameter should be \sphinxcode{\sphinxupquote{\textquotesingle{}Hello world!\textquotesingle{}}}.

Let’s look at the page for the jspsych\sphinxhyphen{}html\sphinxhyphen{}keyboard\sphinxhyphen{}response plugin on the
jsPsych website.

You’ll notice that most of these parameters weren’t specified in our example.
Every parameter has a default value. If a value isn’t given, jsPsych will use
this default value. In the case of html\sphinxhyphen{}keyboard\sphinxhyphen{}response, for example, the default
for \sphinxcode{\sphinxupquote{trial\_duration}} is \sphinxcode{\sphinxupquote{null}}. In the documentation it says:
\begin{quote}

If this is null, then the stimulus will remain visible until the trial ends.
\end{quote}

In other words, the default is to wait until the trial ends. This leads to
another question \textendash{} when does the trial end? Take a look at the
\sphinxcode{\sphinxupquote{response\_ends\_trial}} parameter.


\subsection{Timelines}
\label{\detokenize{jspsych_au:timelines}}
In jsPsych the word “timeline” refers to a sequence of nodes. This can be “the”
timeline which represents the whole experiment, or a smaller timeline
representing part of it.

In our small example:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{init}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{n+nx}{timeline}\PYG{o}{:} \PYG{p}{[}\PYG{n+nx}{trial}\PYG{p}{]}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

Here the timeline is just one item in a list,


\subsection{jsPsych.init}
\label{\detokenize{jspsych_au:jspsych-init}}
Here’s that minimal example of a jsPsych experiment again:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kd}{var} \PYG{n+nx}{trial} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{n+nx}{type}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}html\PYGZhy{}keyboard\PYGZhy{}response\PYGZsq{}}\PYG{p}{,}
    \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}Hello world!\PYGZsq{}}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}

\PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{init}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{n+nx}{timeline}\PYG{o}{:} \PYG{p}{[}\PYG{n+nx}{trial}\PYG{p}{]}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

\sphinxcode{\sphinxupquote{jsPsych.init}} is the function which runs the whole experiment. It takes
one parameter which is a JavaScript object. (Reminder: a JavaScript object,
similar to a Python dictionary, is a set of named values). This object must
at least contain a \sphinxcode{\sphinxupquote{timeline}} which is a list of nodes.

Go back to the jsPsych website and Core Library API \textgreater{} jsPsych. As with the
plugin we looked at, there are lots of other options. Important ones to note
are
\begin{itemize}
\item {} 
\sphinxcode{\sphinxupquote{on\_finish}}, usually used for saving the data

\item {} 
\sphinxcode{\sphinxupquote{preload\_....}} options used to avoid loading delays during the experiment
(instead these delays occur at the start)

\item {} 
\sphinxcode{\sphinxupquote{show\_preload\_progress\_bar}} to use with the above

\end{itemize}


\section{Exercise 1 \textendash{} First experiment}
\label{\detokenize{jspsych_au:exercise-1-first-experiment}}

\subsection{Installing jsPsych}
\label{\detokenize{jspsych_au:installing-jspsych}}
Log in to your server using SSH.

Make sure that jsPsych is activated using the commands you were given in the
server instructions (6.2 Enabling jsPsych).

Now let’s make a directory for jsPsych to live in, download and unpack it.
We’ll need to install \sphinxcode{\sphinxupquote{unzip}} to do this.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
sudo apt install unzip
\PYG{n+nb}{cd} /var/www/html
mkdir jspsych\PYGZhy{}6.1.0
\PYG{n+nb}{cd} jspsych\PYGZhy{}6.1.0
wget https://github.com/jspsych/jsPsych/releases/download/v6.1.0/jspsych\PYGZhy{}6.1.0.zip
unzip jspsych\PYGZhy{}6.1.0.zip
rm jspsych\PYGZhy{}6.1.0.zip
\end{sphinxVerbatim}


\subsection{CyberDuck}
\label{\detokenize{jspsych_au:cyberduck}}
Before we go to the first exercise, it would be useful to make sure that
CyberDuck can edit files on the server
directly \textendash{} this will save you a lot of time.

\DUrole{xref,std,std-ref}{directedit}


\subsection{The Exercise}
\label{\detokenize{jspsych_au:the-exercise}}
Your first exercise is to get the first experiment working on the server!

HTML code:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+cp}{\PYGZlt{}!DOCTYPE html\PYGZgt{}}
\PYG{p}{\PYGZlt{}}\PYG{n+nt}{html}\PYG{p}{\PYGZgt{}}
    \PYG{p}{\PYGZlt{}}\PYG{n+nt}{head}\PYG{p}{\PYGZgt{}}
        \PYG{p}{\PYGZlt{}}\PYG{n+nt}{title}\PYG{p}{\PYGZgt{}}Example experiment\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{title}\PYG{p}{\PYGZgt{}}
        \PYG{p}{\PYGZlt{}}\PYG{n+nt}{script} \PYG{n+na}{src}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}../jspsych\PYGZhy{}6.1.0/jspsych.js\PYGZdq{}}\PYG{p}{\PYGZgt{}}\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{script}\PYG{p}{\PYGZgt{}}
        \PYG{p}{\PYGZlt{}}\PYG{n+nt}{script} \PYG{n+na}{src}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}../jspsych\PYGZhy{}6.1.0/plugins/jspsych\PYGZhy{}html\PYGZhy{}keyboard\PYGZhy{}response.js\PYGZdq{}}\PYG{p}{\PYGZgt{}}\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{script}\PYG{p}{\PYGZgt{}}
        \PYG{p}{\PYGZlt{}}\PYG{n+nt}{script} \PYG{n+na}{src}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}experiment.js\PYGZdq{}}\PYG{p}{\PYGZgt{}}\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{script}\PYG{p}{\PYGZgt{}}
        \PYG{p}{\PYGZlt{}}\PYG{n+nt}{link} \PYG{n+na}{href}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}../jspsych\PYGZhy{}6.1.0/css/jspsych.css\PYGZdq{}} \PYG{n+na}{rel}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}stylesheet\PYGZdq{}} \PYG{n+na}{type}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}text/css\PYGZdq{}}\PYG{p}{\PYGZgt{}}\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{link}\PYG{p}{\PYGZgt{}}
    \PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{head}\PYG{p}{\PYGZgt{}}
    \PYG{p}{\PYGZlt{}}\PYG{n+nt}{body}\PYG{p}{\PYGZgt{}}
    \PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{body}\PYG{p}{\PYGZgt{}}
\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{html}\PYG{p}{\PYGZgt{}}
\end{sphinxVerbatim}

JavaScript code:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kd}{var} \PYG{n+nx}{trial} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{n+nx}{type}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}html\PYGZhy{}keyboard\PYGZhy{}response\PYGZsq{}}\PYG{p}{,}
    \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}Hello world!\PYGZsq{}}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}

\PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{init}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{n+nx}{timeline}\PYG{o}{:} \PYG{p}{[}\PYG{n+nx}{trial}\PYG{p}{]}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
Create a new folder called \sphinxcode{\sphinxupquote{hello}} in \sphinxcode{\sphinxupquote{/var/www/html}} on the server

\item {} 
Look at the code above

\item {} 
Copy the HTML into a file called \sphinxcode{\sphinxupquote{experiment.html}} and the JavaScript into

\end{enumerate}
\begin{quote}

a file called \sphinxcode{\sphinxupquote{experiment.js}}
\end{quote}
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\setcounter{enumi}{3}
\item {} 
Transfer both of these into the new folder that you created on the server

\item {} 
Test out your experiment! The experiment will be on your server at

\end{enumerate}
\begin{quote}

\sphinxcode{\sphinxupquote{https://\textless{}name\textgreater{}.cogsciexperiment.au.dk/hello/experiment.html}}
(fill in your server name of course!)
\end{quote}
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\setcounter{enumi}{5}
\item {} 
Once the experiment is working, you will see “Hello world!”, which should

\end{enumerate}
\begin{quote}

disappear when you press a key
\end{quote}

\begin{sphinxShadowBox}
\sphinxstyletopictitle{Breakout}

I’ll walk through these steps, then we’ll go in to breakout groups to make sure
it’s working for everyone. You may find the information in {\hyperref[\detokenize{jspsych_au:practicalities}]{\sphinxcrossref{Practicalities}}}
below useful if you get stuck.
\end{sphinxShadowBox}


\subsection{More experiments}
\label{\detokenize{jspsych_au:more-experiments}}
Throughout this practical, it’s wise to keep a copy of the code for each
exercise once it’s working. When you start working on a new example, usually
you’ll want to start from
a copy of the previous one. To do this, either use \sphinxcode{\sphinxupquote{cp \sphinxhyphen{}r}} in the terminal, e.g.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
cp \PYGZhy{}r /var/www/html/hello /var/www/html/next\PYGZus{}example
\end{sphinxVerbatim}

or use “Duplicate” in CyberDuck.


\section{Practicalities}
\label{\detokenize{jspsych_au:practicalities}}

\subsection{Terminology \textendash{} Arrays / lists}
\label{\detokenize{jspsych_au:terminology-arrays-lists}}
In JavaScript an Array is a list of items, written:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kd}{var} \PYG{n+nx}{my\PYGZus{}list} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}orange\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}apple\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}banana\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}pear\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}grapefruit\PYGZdq{}}\PYG{p}{]}\PYG{p}{;}
\end{sphinxVerbatim}

I’ve generally used the term “list” for this as I find it more natural (and it
suits the many people who learned Python first!) but please bear in mind that
a lot of documentation and examples will refer to this as an array.


\subsection{File paths}
\label{\detokenize{jspsych_au:file-paths}}
The examples in this document assume that jsPsych and \sphinxcode{\sphinxupquote{record\_result.php}},
are in \sphinxcode{\sphinxupquote{/var/www/html}}, and that all of your experiments are in
subdirectories of \sphinxcode{\sphinxupquote{/var/www/html}}. (We’ll go through installing jsPsych in a
moment). For example, with two experiments, I have:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
/var/www/html
├── hello
│   ├── hello.html
│   └── hello.js
├── index.html
├── loop
│   ├── loop.html
│   └── loop.js
├── record\PYGZus{}result.php
└── jspsych\PYGZhy{}6.1.0
    ├── jspsych.js
    └── ....
\end{sphinxVerbatim}

So from loop.html, I can reference \sphinxcode{\sphinxupquote{jspsych.js}} like this:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{p}{\PYGZlt{}}\PYG{n+nt}{script} \PYG{n+na}{src}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}../jspsych\PYGZhy{}6.1.0/jspsych.js\PYGZdq{}}\PYG{p}{\PYGZgt{}}\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{script}\PYG{p}{\PYGZgt{}}
\end{sphinxVerbatim}

Bear this in mind when looking at the examples, you will have to adapt the
paths for jsPsych and \sphinxcode{\sphinxupquote{record\_result.php}} to the location of these files
on your server.


\subsection{Single file jsPsych experiment}
\label{\detokenize{jspsych_au:single-file-jspsych-experiment}}
You will sometimes see another style used, where the experiment code is inside
the HTML file, rather than in its own file:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+cp}{\PYGZlt{}!DOCTYPE html\PYGZgt{}}
\PYG{p}{\PYGZlt{}}\PYG{n+nt}{html}\PYG{p}{\PYGZgt{}}
    \PYG{p}{\PYGZlt{}}\PYG{n+nt}{head}\PYG{p}{\PYGZgt{}}
        \PYG{p}{\PYGZlt{}}\PYG{n+nt}{title}\PYG{p}{\PYGZgt{}}Example experiment\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{title}\PYG{p}{\PYGZgt{}}
        \PYG{p}{\PYGZlt{}}\PYG{n+nt}{script} \PYG{n+na}{src}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}../jspsych\PYGZhy{}6.1.0/jspsych.js\PYGZdq{}}\PYG{p}{\PYGZgt{}}\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{script}\PYG{p}{\PYGZgt{}}
        \PYG{p}{\PYGZlt{}}\PYG{n+nt}{script} \PYG{n+na}{src}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}../jspsych\PYGZhy{}6.1.0/plugins/jspsych\PYGZhy{}html\PYGZhy{}keyboard\PYGZhy{}response.js\PYGZdq{}}\PYG{p}{\PYGZgt{}}\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{script}\PYG{p}{\PYGZgt{}}
        \PYG{p}{\PYGZlt{}}\PYG{n+nt}{link} \PYG{n+na}{href}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}../jspsych\PYGZhy{}6.1.0/css/jspsych.css\PYGZdq{}} \PYG{n+na}{rel}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}stylesheet\PYGZdq{}} \PYG{n+na}{type}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}text/css\PYGZdq{}}\PYG{p}{\PYGZgt{}}\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{link}\PYG{p}{\PYGZgt{}}
    \PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{head}\PYG{p}{\PYGZgt{}}
    \PYG{p}{\PYGZlt{}}\PYG{n+nt}{body}\PYG{p}{\PYGZgt{}}
    \PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{body}\PYG{p}{\PYGZgt{}}
    \PYG{p}{\PYGZlt{}}\PYG{n+nt}{script}\PYG{p}{\PYGZgt{}}
      \PYG{k+kd}{var} \PYG{n+nx}{trial} \PYG{o}{=} \PYG{p}{\PYGZob{}}
          \PYG{n+nx}{type}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}html\PYGZhy{}keyboard\PYGZhy{}response\PYGZsq{}}\PYG{p}{,}
          \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}Hello world!\PYGZsq{}}
      \PYG{p}{\PYGZcb{}}\PYG{p}{;}

      \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{init}\PYG{p}{(}\PYG{p}{\PYGZob{}}
          \PYG{n+nx}{timeline}\PYG{o}{:} \PYG{p}{[}\PYG{n+nx}{trial}\PYG{p}{]}
      \PYG{p}{\PYGZcb{}}\PYG{p}{)}\PYG{p}{;}
    \PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{script}\PYG{p}{\PYGZgt{}}
\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{html}\PYG{p}{\PYGZgt{}}
\end{sphinxVerbatim}

This is confusing for all but the simplest experiments, but worth mentioning in
case you come across it in other people’s code.


\subsection{HTML file and referencing JavaScript and CSS}
\label{\detokenize{jspsych_au:html-file-and-referencing-javascript-and-css}}
The order of inclusion of JavaScript files is important. In our example:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{p}{\PYGZlt{}}\PYG{n+nt}{script} \PYG{n+na}{src}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}../jspsych\PYGZhy{}6.1.0/jspsych.js\PYGZdq{}}\PYG{p}{\PYGZgt{}}\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{script}\PYG{p}{\PYGZgt{}}
\PYG{p}{\PYGZlt{}}\PYG{n+nt}{script} \PYG{n+na}{src}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}../jspsych\PYGZhy{}6.1.0/plugins/jspsych\PYGZhy{}html\PYGZhy{}keyboard\PYGZhy{}response.js\PYGZdq{}}\PYG{p}{\PYGZgt{}}\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{script}\PYG{p}{\PYGZgt{}}
\PYG{p}{\PYGZlt{}}\PYG{n+nt}{script} \PYG{n+na}{src}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}experiment.js\PYGZdq{}}\PYG{p}{\PYGZgt{}}\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{script}\PYG{p}{\PYGZgt{}}
\end{sphinxVerbatim}

The plugin depends on the jsPsych code \textendash{} it doesn’t make sense without it \textendash{}
so you must load jsPsych first. Likewise our experiment depends on both the
plugin and the core jsPsych library, so they must both be loaded before you load
the experiment. The order must always be:
\begin{itemize}
\item {} 
\sphinxcode{\sphinxupquote{jspsych.js}}

\item {} 
All plugins you are using (forgetting to add these is a common mistake!)

\item {} 
Your experiment file

\end{itemize}

In the example I’m using relative paths for JavaScript files. For example:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{p}{\PYGZlt{}}\PYG{n+nt}{script} \PYG{n+na}{src}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}experiment.js\PYGZdq{}}\PYG{p}{\PYGZgt{}}\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{script}\PYG{p}{\PYGZgt{}}
\end{sphinxVerbatim}

means “load the \sphinxcode{\sphinxupquote{experiment.js}} file, which is in the same directory %
\begin{footnote}[1]\sphinxAtStartFootnote
On some computers, these are also called “folders”.
%
\end{footnote}
as the HTML file”. And:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{p}{\PYGZlt{}}\PYG{n+nt}{script} \PYG{n+na}{src}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}../jspsych\PYGZhy{}6.1.0/jspsych.js\PYGZdq{}}\PYG{p}{\PYGZgt{}}\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{script}\PYG{p}{\PYGZgt{}}
\end{sphinxVerbatim}

means “go up one directory, look for \sphinxcode{\sphinxupquote{jspsych\sphinxhyphen{}6.1.0}}, then in that
\sphinxcode{\sphinxupquote{jspsych.js}}”.

You could also use full links for your JavaScript files
(“\sphinxhref{https://..../experiment.js}{https://…./experiment.js}”) but it’s not necessary.

CSS (stylesheet) code is included using the \sphinxcode{\sphinxupquote{\textless{}link\textgreater{}}} tag. If you want to
add your own style, I recommend that you add your own stylesheet and link to it
\sphinxstyleemphasis{last} \textendash{} that way it will take precedence over anything defined in
\sphinxcode{\sphinxupquote{jspsych.css}}. For example:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{p}{\PYGZlt{}}\PYG{n+nt}{link} \PYG{n+na}{href}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}../jspsych\PYGZhy{}6.1.0/css/jspsych.css\PYGZdq{}} \PYG{n+na}{rel}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}stylesheet\PYGZdq{}} \PYG{n+na}{type}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}text/css\PYGZdq{}}\PYG{p}{\PYGZgt{}}\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{link}\PYG{p}{\PYGZgt{}}
\PYG{p}{\PYGZlt{}}\PYG{n+nt}{link} \PYG{n+na}{href}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}experiment.css\PYGZdq{}} \PYG{n+na}{rel}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}stylesheet\PYGZdq{}} \PYG{n+na}{type}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}text/css\PYGZdq{}}\PYG{p}{\PYGZgt{}}\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{link}\PYG{p}{\PYGZgt{}}
\end{sphinxVerbatim}

(This isn’t required for anything in the exercises, though!)


\section{Browser Developer Tools}
\label{\detokenize{jspsych_au:browser-developer-tools}}
When writing any computer program, it’s always good to have
some tools to help you find out what’s going on. This is
particularly important when something goes wrong! For an
online experiment in JavaScript, you can use the
web developer tools in your browser. All recent versions of
browsers have these tools built in.

First, here’s how to open developer tools for your browser:
\begin{description}
\item[{Firefox}] \leavevmode
In the menu, Web Developer \(\rightarrow\) Toggle Tools (or Ctrl\sphinxhyphen{}Shift\sphinxhyphen{}I)

\item[{Chrome}] \leavevmode
In the menu, More Tools \(\rightarrow\) Developer Tools (or Ctrl\sphinxhyphen{}Shift\sphinxhyphen{}I)

\item[{Internet Explorer/Edge}] \leavevmode
Press F12 to start Developer tools

\item[{Safari}] \leavevmode
Preferences \(\rightarrow\) Advanced and check “Show Develop menu in menu bar”.
Then Develop \(\rightarrow\) Show Web Inspector

\end{description}

In my examples I’ll use Firefox, but these are all fairly similar.

Go to the page for your experiment \textendash{} use the link for the
uploaded copy on the server, not the copy on your computer.

Now go to the web page for the example experiment
you created. Enable Developer Tools (see the list above) and
reload the page. You’ll see something like this:

\noindent\sphinxincludegraphics[width=0.900\linewidth]{{dev_tools}.png}


\subsection{The console}
\label{\detokenize{jspsych_au:the-console}}
Click on the tab marked “Console”. This contains messages from your web browser.
Most useful are the errors! Open your experiment JavaScript file and break the code.
\begin{quote}

Yes, I’m actually telling you to break the code! The easiest way is to delete
a bracket \textendash{} \sphinxcode{\sphinxupquote{(}}, \sphinxcode{\sphinxupquote{{[}}} or \sphinxcode{\sphinxupquote{\{}}, as if these are not in matching pairs that will cause an
error.
\end{quote}

Now reload the page. You should see something like this:

\noindent\sphinxincludegraphics[width=0.900\linewidth]{{dev_tools_error}.png}

There’s an error reported in the console, in red. This will give you a clue as
to where the problem is! You can click on the links on the right which will show
you the relevant parts of the code. While error messages can be a little cryptic,
there’s usually something which will help, like “missing \}”.

Now fix your experiment!


\subsection{The debugger}
\label{\detokenize{jspsych_au:the-debugger}}
These tools can also allow you to step through the code line\sphinxhyphen{}by\sphinxhyphen{}line. Now click
on the tab marked “Debugger” or “Sources”. You’ll see something like this:

\noindent\sphinxincludegraphics[width=0.900\linewidth]{{debugger}.png}

Here you can see your code, and watch it run. Click in the margin next to the code,
on the line:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{init}\PYG{p}{(}\PYG{p}{\PYGZob{}}
\end{sphinxVerbatim}

Now reload the page. The program has stopped on that line. The point that you chose
by clicking in the margin is called a \sphinxstylestrong{breakpoint}.

\noindent\sphinxincludegraphics[width=0.900\linewidth]{{debugger_stopped}.png}

On the right there’s a sidebar called “Scopes”. (This has other names in other browsers,
but there should be a list of names and values somewhere). Here you’ll be able to see what
value different variables have. Some of these are built in to the browser, or part of the
internal workings of jsPsych \textendash{} don’t worry about these for now.

The important thing to note is that you can see the value for the node (in the tutorial,
this is called \sphinxcode{\sphinxupquote{trial}}). As you build up a more complex program there will be
many variables, and their values can change as the program runs, so it’s good
to know that you can inspect this as the program runs.

You can also continue running the program. These tools, or something like them, will be
near the code:

\noindent\sphinxincludegraphics[width=0.200\linewidth]{{debugger_controls}.png}

The first of these controls (the triangle or “play button”)
lets the program continue running until it finishes, or until another breakpoint is reached.
The second steps through the code gradually, one line at a time.


\subsection{The console again}
\label{\detokenize{jspsych_au:the-console-again}}
The console also allows you to try out bits of JavaScript. This can be really
useful for learning, or trying out a small example to figure out why something
doesn’t work.

(Note: in Firefox there is a distinction between “Web Console” and “Browser Console”.
The first one shows just the errors for the page we’re on \textendash{} this is the one we want to use.)

Let’s try out the Array (list) method \sphinxcode{\sphinxupquote{.filter()}}. This takes a function and returns
all the items for which the function returns true.

So in this code (try it!):

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kd}{var} \PYG{n+nx}{example} \PYG{o}{=} \PYG{p}{[}\PYG{l+m+mi}{10}\PYG{p}{,} \PYG{l+m+mi}{5}\PYG{p}{,} \PYG{l+m+mi}{7}\PYG{p}{,} \PYG{l+m+mi}{13}\PYG{p}{,} \PYG{l+m+mi}{8}\PYG{p}{,} \PYG{l+m+mi}{22}\PYG{p}{]}\PYG{p}{;}
\PYG{n+nx}{example}\PYG{p}{.}\PYG{n+nx}{filter}\PYG{p}{(}\PYG{k+kd}{function}\PYG{p}{(}\PYG{n+nx}{x}\PYG{p}{)} \PYG{p}{\PYGZob{}} \PYG{k}{return} \PYG{n+nx}{x} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{10}\PYG{p}{;} \PYG{p}{\PYGZcb{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

wherever the value in the list is greater than 10, \sphinxcode{\sphinxupquote{x \textgreater{} 10}} is \sphinxcode{\sphinxupquote{true}}, and
so it’s included in the result. Where \sphinxcode{\sphinxupquote{x \textgreater{} 10}} is \sphinxcode{\sphinxupquote{false}}, it’s not
included.

Note that I didn’t have to do anything to print out the value. This is a
convenience in the JavaScript console interface \textendash{} if a value is returned it
assumes you want to see it! (This happens in other environments too, for example
the Python and MATLAB
prompts do the same thing).

There are lots of useful methods like this in JavaScript,
particularly for Array and String.
If you find yourself writing custom code for something that seems like it
should be simple, take
a look as it might already be built in to the JavaScript language. You can also
include JavaScript libraries other than jsPsych to add extra functionality.

That concludes the introduction to Developer Tools. Don’t worry if you didn’t understand
everything on the screen when it was running \textendash{} the important thing is to know that it’s
there to help you when your program isn’t working!


\section{Some more capabilities of jsPsych}
\label{\detokenize{jspsych_au:some-more-capabilities-of-jspsych}}

\subsection{Repeating over sets of stimuli}
\label{\detokenize{jspsych_au:repeating-over-sets-of-stimuli}}
A common pattern is to repeat the same type of trial, but with a different
stimulus. The long way to do this in jsPsych is just to type out the full
node each time:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kd}{var} \PYG{n+nx}{trial1} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{n+nx}{type}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}html\PYGZhy{}keyboard\PYGZhy{}response\PYGZsq{}}\PYG{p}{,}
    \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}Hello world!\PYGZsq{}}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}

\PYG{k+kd}{var} \PYG{n+nx}{trial2} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{n+nx}{type}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}html\PYGZhy{}keyboard\PYGZhy{}response\PYGZsq{}}\PYG{p}{,}
    \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}Nice to see you world!\PYGZsq{}}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}

\PYG{k+kd}{var} \PYG{n+nx}{trial3} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{n+nx}{type}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}html\PYGZhy{}keyboard\PYGZhy{}response\PYGZsq{}}\PYG{p}{,}
    \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}Hey world!\PYGZsq{}}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}

\PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{init}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{n+nx}{timeline}\PYG{o}{:} \PYG{p}{[}\PYG{n+nx}{trial1}\PYG{p}{,} \PYG{n+nx}{trial2}\PYG{p}{,} \PYG{n+nx}{trial3}\PYG{p}{]}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

This will be extremely laborious (and error prone) for all but the simplest
experiments, though. You could also use a JavaScript loop. This has the
advantage that the trial list can be inspected (printed to the console, or
looked at in the debugger) when it’s finished, so you can check exactly what
jsPsych has been given:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kd}{var} \PYG{n+nx}{stimulus\PYGZus{}list} \PYG{o}{=} \PYG{p}{[}
  \PYG{l+s+s1}{\PYGZsq{}Hello world!\PYGZsq{}}\PYG{p}{,}
  \PYG{l+s+s1}{\PYGZsq{}Nice to see you world!\PYGZsq{}}\PYG{p}{,}
  \PYG{l+s+s1}{\PYGZsq{}Hey world!\PYGZsq{}}
\PYG{p}{]}

\PYG{n+nx}{trials} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}\PYG{p}{;} \PYG{c+c1}{// start an empty list}
\PYG{k}{for} \PYG{p}{(}\PYG{k+kd}{var} \PYG{n+nx}{greeting} \PYG{k}{of} \PYG{n+nx}{stimulus\PYGZus{}list}\PYG{p}{)} \PYG{p}{\PYGZob{}}
  \PYG{k+kd}{var} \PYG{n+nx}{trial} \PYG{o}{=} \PYG{p}{\PYGZob{}}
      \PYG{n+nx}{type}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}html\PYGZhy{}keyboard\PYGZhy{}response\PYGZsq{}}\PYG{p}{,}
      \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{n+nx}{greeting}
  \PYG{p}{\PYGZcb{}}\PYG{p}{;}
  \PYG{n+nx}{trials}\PYG{p}{.}\PYG{n+nx}{push}\PYG{p}{(}\PYG{n+nx}{trial}\PYG{p}{)}\PYG{p}{;} \PYG{c+c1}{// add to the end of the list}
\PYG{p}{\PYGZcb{}}

\PYG{c+c1}{// e.g. print to Console}
\PYG{n+nx}{console}\PYG{p}{.}\PYG{n+nx}{log}\PYG{p}{(}\PYG{n+nx}{trials}\PYG{p}{)}\PYG{p}{;}

\PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{init}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{n+nx}{timeline}\PYG{o}{:} \PYG{n+nx}{trials}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}\PYG{p}{;} \PYG{c+c1}{// \PYGZdq{}trials\PYGZdq{} is already a list}
\end{sphinxVerbatim}

Finally, you can use jsPsych’s timeline variable feature:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{// Note that this is now a list of JavaScript objects}
\PYG{k+kd}{var} \PYG{n+nx}{stimulus\PYGZus{}list} \PYG{o}{=} \PYG{p}{[}
  \PYG{p}{\PYGZob{}} \PYG{n+nx}{stim}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}Hello world!\PYGZsq{}}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
  \PYG{p}{\PYGZob{}} \PYG{n+nx}{stim}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}Nice to see you world!\PYGZsq{}}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
  \PYG{p}{\PYGZob{}} \PYG{n+nx}{stim}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}Hey world!\PYGZsq{}}\PYG{p}{\PYGZcb{}}
\PYG{p}{]}

\PYG{k+kd}{var} \PYG{n+nx}{trial} \PYG{o}{=} \PYG{p}{\PYGZob{}}
  \PYG{n+nx}{type}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}html\PYGZhy{}keyboard\PYGZhy{}response\PYGZsq{}}\PYG{p}{,}
  \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{timelineVariable}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}stim\PYGZdq{}}\PYG{p}{)}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}

\PYG{c+c1}{// this counts as a single node, but a special one which tells jspsych}
\PYG{c+c1}{// \PYGZdq{}repeat this timeline with these variables\PYGZdq{}}
\PYG{k+kd}{var} \PYG{n+nx}{trials\PYGZus{}with\PYGZus{}variables} \PYG{o}{=} \PYG{p}{\PYGZob{}}
  \PYG{n+nx}{timeline}\PYG{o}{:} \PYG{p}{[}\PYG{n+nx}{trial}\PYG{p}{]}\PYG{p}{,}
  \PYG{n+nx}{timeline\PYGZus{}variables}\PYG{o}{:} \PYG{n+nx}{stimulus\PYGZus{}list}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}

\PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{init}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{n+nx}{timeline}\PYG{o}{:} \PYG{p}{[}\PYG{n+nx}{trials\PYGZus{}with\PYGZus{}variables}\PYG{p}{]}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}\PYG{p}{;} \PYG{c+c1}{// \PYGZdq{}trials\PYGZus{}with\PYGZus{}variables\PYGZdq{} counts as a single node, so make it into a list}
\end{sphinxVerbatim}

Instead of explicitly constructing all of the nodes, we create a special node
(\sphinxcode{\sphinxupquote{trials\_with\_variables}}) which tells jsPsych “repeat this timeline with these
values”. This is an extremely powerful feature of jsPsych but special care is
needed if you want to modify the values in any way before using them \textendash{} more
about that later.


\subsection{Randomisation and repeats}
\label{\detokenize{jspsych_au:randomisation-and-repeats}}
jsPsych has randomisation built in! Take a look at the
\sphinxcode{\sphinxupquote{jspsych.randomization.repeats}} function in “Core Library API”.

This takes an array (list) of values and randomises them with the number of
repeats requested. (If you don’t want repeats, you can set this to 1 of course).

This list can be a list of nodes, or a
stimulus list. So, you could use this to randomise our input stimulus list,
before applying timeline variables:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{// Note that this is now a list of JavaScript objects}
\PYG{k+kd}{var} \PYG{n+nx}{stimulus\PYGZus{}list} \PYG{o}{=} \PYG{p}{[}
  \PYG{p}{\PYGZob{}} \PYG{n+nx}{stim}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}Hello world!\PYGZsq{}}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
  \PYG{p}{\PYGZob{}} \PYG{n+nx}{stim}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}Nice to see you world!\PYGZsq{}}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
  \PYG{p}{\PYGZob{}} \PYG{n+nx}{stim}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}Hey world!\PYGZsq{}}\PYG{p}{\PYGZcb{}}
\PYG{p}{]}

\PYG{k+kd}{var} \PYG{n+nx}{trial} \PYG{o}{=} \PYG{p}{\PYGZob{}}
  \PYG{n+nx}{type}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}html\PYGZhy{}keyboard\PYGZhy{}response\PYGZsq{}}\PYG{p}{,}
  \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{timelineVariable}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}stim\PYGZdq{}}\PYG{p}{)}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}

\PYG{c+c1}{// this counts as a single node, but a special one which tells jspsych}
\PYG{c+c1}{// \PYGZdq{}repeat this timeline with these variables\PYGZdq{}}
\PYG{k+kd}{var} \PYG{n+nx}{trials\PYGZus{}with\PYGZus{}variables} \PYG{o}{=} \PYG{p}{\PYGZob{}}
  \PYG{n+nx}{timeline}\PYG{o}{:} \PYG{p}{[}\PYG{n+nx}{trial}\PYG{p}{]}\PYG{p}{,}
  \PYG{n+nx}{timeline\PYGZus{}variables}\PYG{o}{:} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{randomization}\PYG{p}{.}\PYG{n+nx}{repeats}\PYG{p}{(}\PYG{n+nx}{stimulus\PYGZus{}list}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{)}
\PYG{p}{\PYGZcb{}}\PYG{p}{;} \PYG{c+c1}{// use repeats to repeat each item 3 times and randomise}

\PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{init}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{n+nx}{timeline}\PYG{o}{:} \PYG{p}{[}\PYG{n+nx}{trials\PYGZus{}with\PYGZus{}variables}\PYG{p}{]}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

Here’s another full example using repeats:

{\hyperref[\detokenize{repetition:repetition}]{\sphinxcrossref{\DUrole{std,std-ref}{Repetition code example}}}}


\subsection{Factorial design}
\label{\detokenize{jspsych_au:factorial-design}}
Let’s say that you want to show our three different example stimuli for
two different durations, and use all the possible combinations of these.


\begin{savenotes}\sphinxattablestart
\centering
\begin{tabulary}{\linewidth}[t]{|T|T|}
\hline
\sphinxstyletheadfamily 
stimulus
&\sphinxstyletheadfamily 
stimulus\_duration
\\
\hline
Hello world!
&
250
\\
\hline
Nice to see you
&
250
\\
\hline
Hey world!
&
250
\\
\hline
Hello world!
&
500
\\
\hline
etc.
&
etc.
\\
\hline
\end{tabulary}
\par
\sphinxattableend\end{savenotes}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kd}{var} \PYG{n+nx}{stimulus\PYGZus{}list} \PYG{o}{=} \PYG{p}{[}
  \PYG{l+s+s1}{\PYGZsq{}Hello world!\PYGZsq{}}\PYG{p}{,}
  \PYG{l+s+s1}{\PYGZsq{}Nice to see you world!\PYGZsq{}}\PYG{p}{,}
  \PYG{l+s+s1}{\PYGZsq{}Hey world!\PYGZsq{}}
\PYG{p}{]}\PYG{p}{;}

\PYG{k+kd}{var} \PYG{n+nx}{duration\PYGZus{}list} \PYG{o}{=} \PYG{p}{[}\PYG{l+m+mi}{250}\PYG{p}{,} \PYG{l+m+mi}{500}\PYG{p}{]}\PYG{p}{;} \PYG{c+c1}{// all timings in jsPsych are in ms}

\PYG{k+kd}{var} \PYG{n+nx}{factors} \PYG{o}{=} \PYG{p}{\PYGZob{}} \PYG{n+nx}{stim}\PYG{o}{:} \PYG{n+nx}{stimulus\PYGZus{}list}\PYG{p}{,} \PYG{n+nx}{duration}\PYG{o}{:} \PYG{n+nx}{duration\PYGZus{}list} \PYG{p}{\PYGZcb{}}\PYG{p}{;}

\PYG{n+nx}{factorial\PYGZus{}values} \PYG{o}{=} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{randomization}\PYG{p}{.}\PYG{n+nx}{factorial}\PYG{p}{(}\PYG{n+nx}{factors}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

Now \sphinxcode{\sphinxupquote{factorial\_values}} looks like this:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{p}{[}
  \PYG{p}{\PYGZob{}} \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}Hello world!\PYGZdq{}}\PYG{p}{,} \PYG{n+nx}{duration}\PYG{o}{:} \PYG{l+m+mi}{250} \PYG{p}{\PYGZcb{}}\PYG{p}{,}
  \PYG{p}{\PYGZob{}} \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}Nice to see you world!\PYGZdq{}}\PYG{p}{,} \PYG{n+nx}{duration}\PYG{o}{:} \PYG{l+m+mi}{250} \PYG{p}{\PYGZcb{}}\PYG{p}{,}
  \PYG{p}{\PYGZob{}} \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}Hey world!\PYGZdq{}}\PYG{p}{,} \PYG{n+nx}{duration}\PYG{o}{:} \PYG{l+m+mi}{250} \PYG{p}{\PYGZcb{}}\PYG{p}{,}
  \PYG{p}{\PYGZob{}} \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}Hello world!\PYGZdq{}}\PYG{p}{,} \PYG{n+nx}{duration}\PYG{o}{:} \PYG{l+m+mi}{500} \PYG{p}{\PYGZcb{}}\PYG{p}{,}
  \PYG{c+c1}{// etc.}
\PYG{p}{]}
\end{sphinxVerbatim}

This is the JavaScript code equivalent of our table above. To use the durations,
introduce an extra timeline variable:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kd}{var} \PYG{n+nx}{trial} \PYG{o}{=} \PYG{p}{\PYGZob{}}
  \PYG{n+nx}{type}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}html\PYGZhy{}keyboard\PYGZhy{}response\PYGZsq{}}\PYG{p}{,}
  \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{timelineVariable}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}stim\PYGZdq{}}\PYG{p}{)}\PYG{p}{,}
  \PYG{n+nx}{stimulus\PYGZus{}duration}\PYG{o}{:} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{timelineVariable}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}duration\PYGZdq{}}\PYG{p}{)}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}
\end{sphinxVerbatim}


\subsection{Some full examples}
\label{\detokenize{jspsych_au:some-full-examples}}
Here are two full examples using factorial design. One uses a loop\sphinxhyphen{}based
approach, accumulating nodes:

{\hyperref[\detokenize{multiple_images_loop:multiple-images-loop}]{\sphinxcrossref{\DUrole{std,std-ref}{Multiple images (using a loop)}}}}

and the other uses timeline variables:

{\hyperref[\detokenize{multiple_images:multiple-images}]{\sphinxcrossref{\DUrole{std,std-ref}{Multiple images}}}}


\subsection{Duration and ending trials}
\label{\detokenize{jspsych_au:duration-and-ending-trials}}
If you go back to the documentation on \sphinxcode{\sphinxupquote{html\sphinxhyphen{}keyboard\sphinxhyphen{}response}}, you’ll see that
\sphinxcode{\sphinxupquote{stimulus\_duration}} controls how long the stimulus is displayed; under some
circumstances you might want to use \sphinxcode{\sphinxupquote{trial\_duration}} instead (or as well).

You’ll also wish to consider \sphinxcode{\sphinxupquote{response\_ends\_trial}}. It’s common to need to
display something for a fixed duration, without needing a response. In this
case we can set \sphinxcode{\sphinxupquote{trial\_duration}} to the duration we want, and
\sphinxcode{\sphinxupquote{response\_ends\_trial}} to \sphinxcode{\sphinxupquote{false}}.

Such a node will still appear in the results though. This is unavoidable but
you can make it easier to filter out later by adding the \sphinxcode{\sphinxupquote{data}} parameter.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kd}{var} \PYG{n+nx}{fixation} \PYG{o}{=} \PYG{p}{\PYGZob{}}
  \PYG{n+nx}{type}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}html\PYGZhy{}keyboard\PYGZhy{}response\PYGZsq{}}\PYG{p}{,}
  \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}+\PYGZsq{}}\PYG{p}{,}
  \PYG{n+nx}{trial\PYGZus{}duration}\PYG{o}{:} \PYG{l+m+mi}{300}\PYG{p}{,}
  \PYG{n+nx}{response\PYGZus{}ends\PYGZus{}trial}\PYG{o}{:} \PYG{k+kc}{false}\PYG{p}{,}
  \PYG{n+nx}{data}\PYG{o}{:} \PYG{p}{\PYGZob{}} \PYG{n+nx}{trial\PYGZus{}type}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}fixation\PYGZsq{}} \PYG{p}{\PYGZcb{}}
\PYG{p}{\PYGZcb{}}
\end{sphinxVerbatim}

This \sphinxcode{\sphinxupquote{data}} parameter will create a new column in the results, and for this node
it will have the value “fixation”. (For nodes where it’s not defined, it
will be empty).


\section{Exercise 2 \textendash{} Stroop task}
\label{\detokenize{jspsych_au:exercise-2-stroop-task}}
Let’s create a Stroop task in jsPsych.

In general when creating an experiment,
it’s useful to break the task down into smaller, easily testable things that we
can do. So for now, let’s skip saving data, and just use
\sphinxcode{\sphinxupquote{jsPsych.data.displayData}} to show the results at the end.

Here’s a list of progressively harder tasks to guide you towards a solution:
\begin{itemize}
\item {} 
Display a word in large text in the centre of the screen

\item {} 
Vary the colour of the word

\item {} 
Generate trials for all word / colour combinations using factorial design
(in a real experiment we’d want 50\% congruent and 50\% incongruent trials \textendash{}
I’ll leave that to the end!)

\item {} 
Add a fixation cross before the word stimulus, and a blank screen for an
inter\sphinxhyphen{}trial interval afterwards.

\end{itemize}

Hints to get you started on this task:
\begin{itemize}
\item {} 
You can apply some style to text in HTML without changing the CSS file. You
can enclose the text in tags and use \sphinxcode{\sphinxupquote{style=}}. For example:
\sphinxcode{\sphinxupquote{\textless{}span style="font\sphinxhyphen{}weight: bold"\textgreater{}word\textless{}/span\textgreater{}}}.

\item {} 
Look up the CSS properties \sphinxcode{\sphinxupquote{font\sphinxhyphen{}size}} and \sphinxcode{\sphinxupquote{color}} \textendash{} remember MDN is
good for this!

\item {} 
A blank screen can just be a \sphinxcode{\sphinxupquote{html\sphinxhyphen{}keyboard\sphinxhyphen{}response}} showing an empty
string (\sphinxcode{\sphinxupquote{stimulus: ""}})

\end{itemize}

\begin{sphinxShadowBox}
\sphinxstyletopictitle{Breakout}

Let’s go into our breakout groups to work on this task.
\end{sphinxShadowBox}

Three examples give possible solutions to this exercise:
\begin{itemize}
\item {} 
{\hyperref[\detokenize{stroop_loop:stroop-loop}]{\sphinxcrossref{\DUrole{std,std-ref}{Stroop using a loop}}}}

\item {} 
{\hyperref[\detokenize{stroop_timeline_variables:stroop-timeline-variables}]{\sphinxcrossref{\DUrole{std,std-ref}{Stroop with timeline variables}}}}

\item {} 
{\hyperref[\detokenize{stroop_functions:stroop-functions}]{\sphinxcrossref{\DUrole{std,std-ref}{Stroop with functions}}}}

\end{itemize}


\subsection{Seeing the results (and back to functional programming)}
\label{\detokenize{jspsych_au:seeing-the-results-and-back-to-functional-programming}}
Eventually, you’ll want to save data to the server. In the meantime, there’s a
function built in to jsPsych to see the
results of an experiment in the browser window. This is useful when you’re
working on the experiment (and of course for learning).

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{init}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{n+nx}{timeline}\PYG{o}{:} \PYG{p}{[}\PYG{n+nx}{trials\PYGZus{}with\PYGZus{}variables}\PYG{p}{]}\PYG{p}{,}
    \PYG{n+nx}{on\PYGZus{}finish}\PYG{o}{:} \PYG{k+kd}{function}\PYG{p}{(}\PYG{p}{)} \PYG{p}{\PYGZob{}}
        \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{data}\PYG{p}{.}\PYG{n+nx}{displayData}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}csv\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
    \PYG{p}{\PYGZcb{}}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

What’s going on here? A function is defined and given to \sphinxcode{\sphinxupquote{jsPsych.init}} in the
\sphinxcode{\sphinxupquote{on\_finish}} parameter. jsPsych will store that function and run it when the
experiment ends. This is called an “anonymous” function, simply because it
doesn’t have a name. You could equally well define a function and give its name:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kd}{function} \PYG{n+nx}{show\PYGZus{}code}\PYG{p}{(}\PYG{p}{)} \PYG{p}{\PYGZob{}}
  \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{data}\PYG{p}{.}\PYG{n+nx}{displayData}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}csv\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\PYG{p}{\PYGZcb{}}

\PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{init}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{n+nx}{timeline}\PYG{o}{:} \PYG{p}{[}\PYG{n+nx}{trials\PYGZus{}with\PYGZus{}variables}\PYG{p}{]}\PYG{p}{,}
    \PYG{n+nx}{on\PYGZus{}finish}\PYG{o}{:} \PYG{n+nx}{show\PYGZus{}code}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

This is an unusual style in JavaScript, though. Finally, newer versions of
JavaScript have an alternative way of defining
functions called the “arrow syntax”. If you used this, it would look like:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{init}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{n+nx}{timeline}\PYG{o}{:} \PYG{p}{[}\PYG{n+nx}{trials\PYGZus{}with\PYGZus{}variables}\PYG{p}{]}\PYG{p}{,}
    \PYG{n+nx}{on\PYGZus{}finish}\PYG{o}{:} \PYG{p}{(}\PYG{p}{)} \PYG{p}{=\PYGZgt{}} \PYG{p}{\PYGZob{}} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{data}\PYG{p}{.}\PYG{n+nx}{displayData}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}csv\PYGZsq{}}\PYG{p}{)}\PYG{p}{;} \PYG{p}{\PYGZcb{}}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}

I won’t use this in our examples, but I mention it because you might see it in
other code examples.

This goes back to the previous discussion of the functional programming style.
Passing a function in to another function, to be executed later, is
characteristic of this style.


\section{Exercise 3 \textendash{} Saving data}
\label{\detokenize{jspsych_au:exercise-3-saving-data}}
Add data saving to your Stroop task.

\DUrole{xref,std,std-ref}{data}


\section{Extra Exercise \sphinxhyphen{} Participant numbers}
\label{\detokenize{jspsych_au:extra-exercise-participant-numbers}}
\DUrole{xref,std,std-ref}{ppt}


\subsection{More advanced use of timeline variables}
\label{\detokenize{jspsych_au:more-advanced-use-of-timeline-variables}}
In the example with \sphinxcode{\sphinxupquote{stimulus\_list}} above, let’s say that I want the greeting
to be in a heavy font style.
In HTML this would be:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{p}{\PYGZlt{}}\PYG{n+nt}{strong}\PYG{p}{\PYGZgt{}}Hello world!\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{strong}\PYG{p}{\PYGZgt{}}
\end{sphinxVerbatim}

Note that this is just a hint to the browser \textendash{} though the convention is that
browsers render it as boldface. Something like a screen reader may
raise the volume for the “strong” text, for example. CSS can also define
\sphinxcode{\sphinxupquote{strong}} to mean something else.

Going back to the example, we could just add this to each stimulus manually:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kd}{var} \PYG{n+nx}{stimulus\PYGZus{}list} \PYG{o}{=} \PYG{p}{[}
  \PYG{l+s+s1}{\PYGZsq{}\PYGZlt{}strong\PYGZgt{}Hello world!\PYGZlt{}/strong\PYGZgt{}\PYGZsq{}}\PYG{p}{,}
  \PYG{l+s+s1}{\PYGZsq{}\PYGZlt{}strong\PYGZgt{}Nice to see you world!\PYGZlt{}/strong\PYGZgt{}\PYGZsq{}}\PYG{p}{,}
  \PYG{l+s+s1}{\PYGZsq{}\PYGZlt{}strong\PYGZgt{}Hey world!\PYGZlt{}/strong\PYGZgt{}\PYGZsq{}}
\PYG{p}{]}\PYG{p}{;}
\end{sphinxVerbatim}

This is fine for a small example, but what if you have 50 stimuli? If you then
changed your mind and decided to use \sphinxcode{\sphinxupquote{\textless{}em\textgreater{}}}, you’d have to go back and edit
them all with find and replace! You might think we could just do this:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{// **** THIS IS WRONG, DON\PYGZsq{}T DO THIS ****}
\PYG{k+kd}{var} \PYG{n+nx}{trial} \PYG{o}{=} \PYG{p}{\PYGZob{}}
  \PYG{n+nx}{type}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}html\PYGZhy{}keyboard\PYGZhy{}response\PYGZsq{}}\PYG{p}{,}
  \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{timelineVariable}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}stim\PYGZdq{}}\PYG{p}{)}\PYG{p}{,}
  \PYG{n+nx}{stimulus\PYGZus{}duration}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}\PYGZlt{}strong\PYGZgt{}\PYGZdq{}}\PYG{o}{+}\PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{timelineVariable}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}duration\PYGZdq{}}\PYG{p}{)}\PYG{o}{+}\PYG{l+s+s2}{\PYGZdq{}\PYGZlt{}/strong\PYGZgt{}\PYGZdq{}}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}
\end{sphinxVerbatim}

Unfortunately this doesn’t work! The reasons why are beyond the scope of this
workshop \textendash{} for now, just note that if you want to do anything non\sphinxhyphen{}trivial with
a timeline variable, you have to:
\begin{itemize}
\item {} 
enclose it in a function, and

\item {} 
give it an extra parameter set to \sphinxcode{\sphinxupquote{true}} to let it know that it’s being used
in this different way.

\end{itemize}

The correct way to add the \sphinxcode{\sphinxupquote{\textless{}strong\textgreater{}}} tags would be:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kd}{var} \PYG{n+nx}{trial} \PYG{o}{=} \PYG{p}{\PYGZob{}}
  \PYG{n+nx}{type}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}html\PYGZhy{}keyboard\PYGZhy{}response\PYGZsq{}}\PYG{p}{,}
  \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{timelineVariable}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}stim\PYGZdq{}}\PYG{p}{)}\PYG{p}{,}
  \PYG{n+nx}{stimulus\PYGZus{}duration}\PYG{o}{:} \PYG{k+kd}{function}\PYG{p}{(}\PYG{p}{)} \PYG{p}{\PYGZob{}}
    \PYG{k}{return} \PYG{l+s+s2}{\PYGZdq{}\PYGZlt{}strong\PYGZgt{}\PYGZdq{}}\PYG{o}{+}\PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{timelineVariable}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}duration\PYGZdq{}}\PYG{p}{,} \PYG{k+kc}{true}\PYG{p}{)}\PYG{o}{+}\PYG{l+s+s2}{\PYGZdq{}\PYGZlt{}/strong\PYGZgt{}\PYGZdq{}}
  \PYG{p}{\PYGZcb{}} \PYG{c+c1}{// note extra \PYGZdq{}, true\PYGZdq{} above, it\PYGZsq{}s a common mistake to leave it out}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}
\end{sphinxVerbatim}


\subsection{Other useful parameters for timeline nodes}
\label{\detokenize{jspsych_au:other-useful-parameters-for-timeline-nodes}}
If you’ve defined a node to repeat a timeline over a set of values for timeline
variables, you can also easily add repeats, randomisation and sampling. For
example:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kd}{var} \PYG{n+nx}{trials\PYGZus{}with\PYGZus{}variables} \PYG{o}{=} \PYG{p}{\PYGZob{}}
  \PYG{n+nx}{timeline}\PYG{o}{:} \PYG{p}{[}\PYG{n+nx}{trial}\PYG{p}{]}\PYG{p}{,}
  \PYG{n+nx}{timeline\PYGZus{}variables}\PYG{o}{:} \PYG{n+nx}{stimulus\PYGZus{}list}\PYG{p}{,}
  \PYG{n+nx}{randomize\PYGZus{}order}\PYG{o}{:} \PYG{k+kc}{true}\PYG{p}{,}
  \PYG{n+nx}{repetitions}\PYG{o}{:} \PYG{l+m+mi}{5}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}
\end{sphinxVerbatim}

Note that this differs from \sphinxcode{\sphinxupquote{jsPsych.randomization.repeats}} \textendash{} that function
mixes all of the repeats together. Using \sphinxcode{\sphinxupquote{repetitions}} will repeat the whole
set (in a random order) a certain number of times.

There are also options for sampling from a list of trials, see
\sphinxurl{https://www.jspsych.org/overview/timeline/\#sampling-methods} .


\subsection{Flow control}
\label{\detokenize{jspsych_au:flow-control}}
Either using a list of nodes, or timeline variables, it’s possible
to run through a sequence of predetermined actions. What if you want to do
something depending on a participant’s responses?

jsPsych has the ability to:
\begin{itemize}
\item {} 
repeat a timeline while a condition is true

\item {} 
display a timeline or not, depending on a condition

\end{itemize}


\subsubsection{Looping}
\label{\detokenize{jspsych_au:looping}}
Adding the \sphinxcode{\sphinxupquote{loop\_function}} attribute to a node will make it repeat
as long as the given function returns true. Typically this is used for
practice trials which you wish to repeat until the participant gets the correct
answer.


\subsubsection{Conditional}
\label{\detokenize{jspsych_au:conditional}}
Similarly, the \sphinxcode{\sphinxupquote{condition\_function}} parameter gives a function to be run
whenever the node is reached; if it returns true then the node is run,
otherwise it isn’t.

This can be used for things like screening out participants who do badly (or
have poor quality data which suggests they aren’t paying attention) in
practice trials.

There are examples of looping and conditionals in the jsPsych documentation,
under “Overview”.


\subsection{Getting hold of data inside the experiment}
\label{\detokenize{jspsych_au:getting-hold-of-data-inside-the-experiment}}
In order to use looping or conditionals, we need access to data inside the
experiment \textendash{} asking questions like “what was the last response”?

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{data}\PYG{p}{.}\PYG{n+nx}{get}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

gets hold of the whole dataset \textendash{} but this is a DataCollection object.

To get hold of the last \sphinxstyleemphasis{result} we can use:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{data}\PYG{p}{.}\PYG{n+nx}{get}\PYG{p}{(}\PYG{p}{)}\PYG{p}{.}\PYG{n+nx}{values}\PYG{p}{(}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}
\end{sphinxVerbatim}

This is where it becomes valuable to add extra fields to your nodes under the
\sphinxcode{\sphinxupquote{data}} parameter. These will always appear in the results, which will make it
easier to filter results. For example, if you have “experiment” and “filler”
trials and they are appropriately marked, something like:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{data}\PYG{p}{.}\PYG{n+nx}{get}\PYG{p}{(}\PYG{p}{)}\PYG{p}{.}\PYG{n+nx}{filter}\PYG{p}{(}\PYG{p}{\PYGZob{}}\PYG{n+nx}{trial\PYGZus{}type}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}experiment\PYGZdq{}}\PYG{p}{\PYGZcb{}}\PYG{p}{)}\PYG{p}{.}\PYG{n+nx}{values}\PYG{p}{(}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}
\end{sphinxVerbatim}

would give the last experiment trial.


\chapter{Database saving example}
\label{\detokenize{database_saving:database-saving-example}}\label{\detokenize{database_saving::doc}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
sudo apt install php\PYGZhy{}pgsql

sudo su \PYGZhy{} postgres
psql
\end{sphinxVerbatim}

on the psql prompt:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
create database test1;
\PYGZbs{}c test1
create table mydata (
 id serial primary key,
 participant integer not null,
 keypress char(1),
 rt\PYGZus{}ms integer
);
\end{sphinxVerbatim}

and then exit from psql and the postgres account (ctrl\sphinxhyphen{}D for both)

Add the following code to a PHP file, in my example it’s in \sphinxcode{\sphinxupquote{/var/www/html/test\_pg.php}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+cp}{\PYGZlt{}?php}
\PYG{c+c1}{// take in the uploaded data}
\PYG{n+nv}{\PYGZdl{}json} \PYG{o}{=} \PYG{n+nb}{file\PYGZus{}get\PYGZus{}contents}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}php://input\PYGZsq{}}\PYG{p}{);}
\PYG{c+c1}{// treat it as json}
\PYG{n+nv}{\PYGZdl{}obj} \PYG{o}{=} \PYG{n+nb}{json\PYGZus{}decode}\PYG{p}{(}\PYG{n+nv}{\PYGZdl{}json}\PYG{p}{,} \PYG{k}{true}\PYG{p}{);}

\PYG{c+c1}{// this will be e.g.}
\PYG{c+c1}{// \PYGZob{} participant: 12, response\PYGZus{}key: \PYGZsq{}c\PYGZsq{}, rt: 210 \PYGZcb{}}
\PYG{c+c1}{// as sent from}

\PYG{c+c1}{// ADD THE RIGHT DB PASSWORD AND NAME}
\PYG{n+nv}{\PYGZdl{}connection} \PYG{o}{=} \PYG{n+nb}{pg\PYGZus{}connect}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{user=postgres password=XXXXXXX host=localhost dbname=test1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)} \PYG{k}{or} \PYG{k}{die}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Couldn\PYGZsq{}t connect to database}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{);}

\PYG{c+c1}{// ADD THE RIGHT TABLE NAME (instead of mydata)}
\PYG{n+nv}{\PYGZdl{}stmt} \PYG{o}{=} \PYG{n+nb}{pg\PYGZus{}prepare}\PYG{p}{(}
        \PYG{n+nv}{\PYGZdl{}connection}\PYG{p}{,}
        \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{add\PYGZus{}data}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
        \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{insert into mydata (participant, keypress, rt\PYGZus{}ms) values (}\PYG{l+s+s2}{\PYGZdl{}}\PYG{l+s+s2}{1, }\PYG{l+s+s2}{\PYGZdl{}}\PYG{l+s+s2}{2, }\PYG{l+s+s2}{\PYGZdl{}}\PYG{l+s+s2}{3)}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{p}{);}

\PYG{n+nv}{\PYGZdl{}result} \PYG{o}{=} \PYG{n+nb}{pg\PYGZus{}execute}\PYG{p}{(}
        \PYG{n+nv}{\PYGZdl{}connection}\PYG{p}{,}
        \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{add\PYGZus{}data}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
        \PYG{k}{array}\PYG{p}{(}\PYG{n+nv}{\PYGZdl{}obj}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{participant}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{],} \PYG{n+nv}{\PYGZdl{}obj}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{response\PYGZus{}key}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{],} \PYG{n+nv}{\PYGZdl{}obj}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{rt}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{])}
\PYG{p}{)} \PYG{k}{or} \PYG{k}{die}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{INSERT failed}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{);}

\PYG{c+cp}{?\PYGZgt{}}
\end{sphinxVerbatim}

In \sphinxcode{\sphinxupquote{/var/www/html/stroop}}, add the following to \sphinxcode{\sphinxupquote{stroop.html}}:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+cp}{\PYGZlt{}!DOCTYPE html\PYGZgt{}}
\PYG{p}{\PYGZlt{}}\PYG{n+nt}{html}\PYG{p}{\PYGZgt{}}
    \PYG{p}{\PYGZlt{}}\PYG{n+nt}{head}\PYG{p}{\PYGZgt{}}
        \PYG{p}{\PYGZlt{}}\PYG{n+nt}{meta} \PYG{n+na}{charset}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}UTF\PYGZhy{}8\PYGZdq{}}\PYG{p}{\PYGZgt{}}
        \PYG{p}{\PYGZlt{}}\PYG{n+nt}{title}\PYG{p}{\PYGZgt{}}Stroop task\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{title}\PYG{p}{\PYGZgt{}}
        \PYG{p}{\PYGZlt{}}\PYG{n+nt}{script} \PYG{n+na}{src}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}../jspsych\PYGZhy{}6.1.0/jspsych.js\PYGZdq{}}\PYG{p}{\PYGZgt{}}\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{script}\PYG{p}{\PYGZgt{}}
        \PYG{p}{\PYGZlt{}}\PYG{n+nt}{script} \PYG{n+na}{src}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}../jspsych\PYGZhy{}6.1.0/plugins/jspsych\PYGZhy{}html\PYGZhy{}keyboard\PYGZhy{}response.js\PYGZdq{}}\PYG{p}{\PYGZgt{}}\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{script}\PYG{p}{\PYGZgt{}}
        \PYG{p}{\PYGZlt{}}\PYG{n+nt}{script} \PYG{n+na}{src}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}stroop.js\PYGZdq{}}\PYG{p}{\PYGZgt{}}\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{script}\PYG{p}{\PYGZgt{}}
        \PYG{p}{\PYGZlt{}}\PYG{n+nt}{link} \PYG{n+na}{href}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}../jspsych\PYGZhy{}6.1.0/css/jspsych.css\PYGZdq{}} \PYG{n+na}{rel}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}stylesheet\PYGZdq{}} \PYG{n+na}{type}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}text/css\PYGZdq{}}\PYG{p}{\PYGZgt{}}\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{link}\PYG{p}{\PYGZgt{}}
    \PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{head}\PYG{p}{\PYGZgt{}}
    \PYG{p}{\PYGZlt{}}\PYG{n+nt}{body}\PYG{p}{\PYGZgt{}}
    \PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{body}\PYG{p}{\PYGZgt{}}
\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{html}\PYG{p}{\PYGZgt{}}

and this to ``stroop.js``:
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kd}{var} \PYG{n+nx}{words} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}blå\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}gul\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}grøn\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}rød\PYGZsq{}}\PYG{p}{]}\PYG{p}{;}
\PYG{k+kd}{var} \PYG{n+nx}{colours} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}blue\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}yellow\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}green\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}red\PYGZdq{}}\PYG{p}{]}\PYG{p}{;}


\PYG{k+kd}{var} \PYG{n+nx}{factors} \PYG{o}{=} \PYG{p}{\PYGZob{}} \PYG{n+nx}{word}\PYG{o}{:} \PYG{n+nx}{words}\PYG{p}{,} \PYG{n+nx}{colour}\PYG{o}{:} \PYG{n+nx}{colours} \PYG{p}{\PYGZcb{}}\PYG{p}{;}

\PYG{k+kd}{var} \PYG{n+nx}{factorial\PYGZus{}table} \PYG{o}{=} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{randomization}\PYG{p}{.}\PYG{n+nx}{factorial}\PYG{p}{(}\PYG{n+nx}{factors}\PYG{p}{)}\PYG{p}{;}

\PYG{k+kd}{var} \PYG{n+nx}{trial} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{n+nx}{type}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}html\PYGZhy{}keyboard\PYGZhy{}response\PYGZsq{}}\PYG{p}{,}
    \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{k+kd}{function} \PYG{p}{(}\PYG{p}{)} \PYG{p}{\PYGZob{}}
        \PYG{c+c1}{// e.g. \PYGZlt{}span style=\PYGZdq{}color: blue\PYGZdq{}\PYGZgt{}red\PYGZlt{}/span\PYGZgt{}}
        \PYG{k}{return} \PYG{p}{(}
            \PYG{l+s+s1}{\PYGZsq{}\PYGZlt{}span style=\PYGZdq{}font\PYGZhy{}size: xx\PYGZhy{}large; color:\PYGZsq{}}\PYG{o}{+}\PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{timelineVariable}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}colour\PYGZdq{}}\PYG{p}{,} \PYG{k+kc}{true}\PYG{p}{)}\PYG{o}{+}\PYG{l+s+s1}{\PYGZsq{}\PYGZdq{}\PYGZgt{}\PYGZsq{}}\PYG{o}{+}
            \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{timelineVariable}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}word\PYGZdq{}}\PYG{p}{,} \PYG{k+kc}{true}\PYG{p}{)}\PYG{o}{+}\PYG{l+s+s1}{\PYGZsq{}\PYGZlt{}/span\PYGZgt{}\PYGZsq{}}
        \PYG{p}{)}\PYG{p}{;}
    \PYG{p}{\PYGZcb{}}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}

\PYG{k+kd}{var} \PYG{n+nx}{timeline\PYGZus{}variable\PYGZus{}node} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{n+nx}{timeline}\PYG{o}{:} \PYG{p}{[}\PYG{n+nx}{trial}\PYG{p}{]}\PYG{p}{,}
    \PYG{n+nx}{timeline\PYGZus{}variables}\PYG{o}{:} \PYG{n+nx}{factorial\PYGZus{}table}
\PYG{p}{\PYGZcb{}}

\PYG{k+kd}{function} \PYG{n+nx}{saveTrialData}\PYG{p}{(}\PYG{n+nx}{data}\PYG{p}{)}\PYG{p}{\PYGZob{}}
    \PYG{c+c1}{// instead of sending text CSV, send the record as JSON}
    \PYG{c+c1}{// e.g. \PYGZob{}}
    \PYG{c+c1}{// participant: 1,}
    \PYG{c+c1}{// keypress: \PYGZsq{}v\PYGZsq{},}
    \PYG{c+c1}{// etc.}
    \PYG{c+c1}{// \PYGZcb{}}
    \PYG{k+kd}{var} \PYG{n+nx}{url} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}../test\PYGZus{}pg.php\PYGZsq{}}\PYG{p}{;} \PYG{c+c1}{// THIS MUST MATCH THE DB SAVING SCRIPT}
    \PYG{k+kd}{var} \PYG{n+nx}{data\PYGZus{}to\PYGZus{}send} \PYG{o}{=} \PYG{n+nx}{data}\PYG{p}{;}
    \PYG{c+c1}{// translate keypress}
    \PYG{n+nx}{data\PYGZus{}to\PYGZus{}send}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}response\PYGZus{}key\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{pluginAPI}\PYG{p}{.}\PYG{n+nx}{convertKeyCodeToKeyCharacter}\PYG{p}{(}\PYG{n+nx}{data}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}key\PYGZus{}press\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}\PYG{p}{;}
    \PYG{c+c1}{// fixed value for now! add the real participant number later elsewhere}
    \PYG{c+c1}{// in the code, and delete this line}
    \PYG{n+nx}{data\PYGZus{}to\PYGZus{}send}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}participant\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{l+m+mi}{12}\PYG{p}{;}
    \PYG{n+nx}{fetch}\PYG{p}{(}\PYG{n+nx}{url}\PYG{p}{,} \PYG{p}{\PYGZob{}}
        \PYG{n+nx}{method}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}POST\PYGZsq{}}\PYG{p}{,}
        \PYG{n+nx}{body}\PYG{o}{:} \PYG{n+nx}{JSON}\PYG{p}{.}\PYG{n+nx}{stringify}\PYG{p}{(}\PYG{n+nx}{data\PYGZus{}to\PYGZus{}send}\PYG{p}{)}\PYG{p}{,}
        \PYG{n+nx}{headers}\PYG{o}{:} \PYG{k}{new} \PYG{n+nx}{Headers}\PYG{p}{(}\PYG{p}{\PYGZob{}}
                \PYG{l+s+s1}{\PYGZsq{}Content\PYGZhy{}Type\PYGZsq{}}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}application/json\PYGZsq{}}
        \PYG{p}{\PYGZcb{}}\PYG{p}{)}
    \PYG{p}{\PYGZcb{}}\PYG{p}{)}\PYG{p}{;}
\PYG{p}{\PYGZcb{}}

\PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{init}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{n+nx}{timeline}\PYG{o}{:} \PYG{p}{[}\PYG{n+nx}{timeline\PYGZus{}variable\PYGZus{}node}\PYG{p}{]}\PYG{p}{,}
    \PYG{n+nx}{on\PYGZus{}data\PYGZus{}update}\PYG{o}{:} \PYG{k+kd}{function}\PYG{p}{(}\PYG{n+nx}{data}\PYG{p}{)} \PYG{p}{\PYGZob{}}
        \PYG{n+nx}{saveTrialData}\PYG{p}{(}\PYG{n+nx}{data}\PYG{p}{)}\PYG{p}{;}
    \PYG{p}{\PYGZcb{}}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}


\chapter{Repetition code example}
\label{\detokenize{repetition:repetition-code-example}}\label{\detokenize{repetition:repetition}}\label{\detokenize{repetition::doc}}
Make sure you either have these images uploaded to the server, or change the filenames to match your own images!

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kd}{var} \PYG{n+nx}{dog1\PYGZus{}trial} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{n+nx}{type}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}image\PYGZhy{}keyboard\PYGZhy{}response\PYGZsq{}}\PYG{p}{,}
    \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}Dog1.jpg\PYGZsq{}}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}

\PYG{k+kd}{var} \PYG{n+nx}{dog2\PYGZus{}trial} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{n+nx}{type}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}image\PYGZhy{}keyboard\PYGZhy{}response\PYGZsq{}}\PYG{p}{,}
    \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}Dog2.jpg\PYGZsq{}}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}

\PYG{k+kd}{var} \PYG{n+nx}{trials} \PYG{o}{=} \PYG{p}{[}\PYG{n+nx}{dog1\PYGZus{}trial}\PYG{p}{,} \PYG{n+nx}{dog2\PYGZus{}trial}\PYG{p}{]}\PYG{p}{;}
\PYG{k+kd}{var} \PYG{n+nx}{repeated\PYGZus{}trials} \PYG{o}{=} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{randomization}\PYG{p}{.}\PYG{n+nx}{repeat}\PYG{p}{(}\PYG{n+nx}{trials}\PYG{p}{,}\PYG{l+m+mi}{5}\PYG{p}{)}\PYG{p}{;}

\PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{init}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{n+nx}{timeline}\PYG{o}{:} \PYG{n+nx}{repeated\PYGZus{}trials}\PYG{p}{,}
    \PYG{n+nx}{on\PYGZus{}finish}\PYG{o}{:} \PYG{k+kd}{function}\PYG{p}{(}\PYG{p}{)} \PYG{p}{\PYGZob{}}
        \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{data}\PYG{p}{.}\PYG{n+nx}{displayData}\PYG{p}{(}\PYG{p}{)}\PYG{p}{;}
    \PYG{p}{\PYGZcb{}}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}


\chapter{Factorial code example}
\label{\detokenize{factorial:factorial-code-example}}\label{\detokenize{factorial:factorial}}\label{\detokenize{factorial::doc}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kd}{var} \PYG{n+nx}{factors} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}Dog1.jpg\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}Dog2.jpg\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}Dog3.jpg\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}
    \PYG{n+nx}{stimulus\PYGZus{}duration}\PYG{o}{:} \PYG{p}{[}\PYG{l+m+mi}{400}\PYG{p}{,} \PYG{l+m+mi}{800}\PYG{p}{,} \PYG{l+m+mi}{1200}\PYG{p}{]}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}

\PYG{k+kd}{var} \PYG{n+nx}{factorial\PYGZus{}values} \PYG{o}{=} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{randomization}\PYG{p}{.}\PYG{n+nx}{factorial}\PYG{p}{(}\PYG{n+nx}{factors}\PYG{p}{)}\PYG{p}{;}

\PYG{k+kd}{var} \PYG{n+nx}{trial} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{n+nx}{type}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}image\PYGZhy{}keyboard\PYGZhy{}response\PYGZsq{}}\PYG{p}{,}
    \PYG{n+nx}{prompt}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}\PYGZlt{}p\PYGZgt{}Press a key!\PYGZlt{}/p\PYGZgt{}\PYGZsq{}}\PYG{p}{,}
    \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{timelineVariable}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}stimulus\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
    \PYG{n+nx}{stimulus\PYGZus{}duration}\PYG{o}{:} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{timelineVariable}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}stimulus\PYGZus{}duration\PYGZsq{}}\PYG{p}{)}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}

\PYG{k+kd}{var} \PYG{n+nx}{trials\PYGZus{}with\PYGZus{}variables} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{n+nx}{timeline}\PYG{o}{:} \PYG{p}{[}\PYG{n+nx}{trial}\PYG{p}{]}\PYG{p}{,}
    \PYG{n+nx}{timeline\PYGZus{}variables}\PYG{o}{:} \PYG{n+nx}{factorial\PYGZus{}values}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}

\PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{init}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{n+nx}{timeline}\PYG{o}{:} \PYG{p}{[}\PYG{n+nx}{trials\PYGZus{}with\PYGZus{}variables}\PYG{p}{]}\PYG{p}{,}
    \PYG{n+nx}{on\PYGZus{}finish}\PYG{o}{:} \PYG{k+kd}{function}\PYG{p}{(}\PYG{p}{)} \PYG{p}{\PYGZob{}}
        \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{data}\PYG{p}{.}\PYG{n+nx}{displayData}\PYG{p}{(}\PYG{p}{)}\PYG{p}{;}
    \PYG{p}{\PYGZcb{}}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}


\chapter{Factorial code example with fixation}
\label{\detokenize{factorial_with_fixation:factorial-code-example-with-fixation}}\label{\detokenize{factorial_with_fixation:factorial-with-fixation}}\label{\detokenize{factorial_with_fixation::doc}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kd}{var} \PYG{n+nx}{factors} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}Dog1.jpg\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}Dog2.jpg\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}Dog3.jpg\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}
    \PYG{n+nx}{stimulus\PYGZus{}duration}\PYG{o}{:} \PYG{p}{[}\PYG{l+m+mi}{400}\PYG{p}{,} \PYG{l+m+mi}{800}\PYG{p}{,} \PYG{l+m+mi}{1200}\PYG{p}{]}\PYG{p}{,}
    \PYG{n+nx}{fixation\PYGZus{}duration}\PYG{o}{:} \PYG{p}{[}\PYG{l+m+mi}{250}\PYG{p}{,} \PYG{l+m+mi}{500}\PYG{p}{,} \PYG{l+m+mi}{750}\PYG{p}{]}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}

\PYG{k+kd}{var} \PYG{n+nx}{factorial\PYGZus{}values} \PYG{o}{=} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{randomization}\PYG{p}{.}\PYG{n+nx}{factorial}\PYG{p}{(}\PYG{n+nx}{factors}\PYG{p}{)}\PYG{p}{;}

\PYG{k+kd}{var} \PYG{n+nx}{fixation} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{n+nx}{type}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}html\PYGZhy{}keyboard\PYGZhy{}response\PYGZsq{}}\PYG{p}{,}
    \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}+\PYGZsq{}}\PYG{p}{,}
    \PYG{n+nx}{trial\PYGZus{}duration}\PYG{o}{:} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{timelineVariable}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}fixation\PYGZus{}duration\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
    \PYG{n+nx}{response\PYGZus{}ends\PYGZus{}trial}\PYG{o}{:} \PYG{k+kc}{false}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}

\PYG{k+kd}{var} \PYG{n+nx}{trial} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{n+nx}{type}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}image\PYGZhy{}keyboard\PYGZhy{}response\PYGZsq{}}\PYG{p}{,}
    \PYG{n+nx}{prompt}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}\PYGZlt{}p\PYGZgt{}Press a key!\PYGZlt{}/p\PYGZgt{}\PYGZsq{}}\PYG{p}{,}
    \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{timelineVariable}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}stimulus\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
    \PYG{n+nx}{stimulus\PYGZus{}duration}\PYG{o}{:} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{timelineVariable}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}stimulus\PYGZus{}duration\PYGZsq{}}\PYG{p}{)}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}

\PYG{k+kd}{var} \PYG{n+nx}{trials\PYGZus{}with\PYGZus{}variables} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{n+nx}{timeline}\PYG{o}{:} \PYG{p}{[}\PYG{n+nx}{fixation}\PYG{p}{,} \PYG{n+nx}{trial}\PYG{p}{]}\PYG{p}{,}
    \PYG{n+nx}{timeline\PYGZus{}variables}\PYG{o}{:} \PYG{n+nx}{factorial\PYGZus{}values}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}

\PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{init}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{n+nx}{timeline}\PYG{o}{:} \PYG{p}{[}\PYG{n+nx}{trials\PYGZus{}with\PYGZus{}variables}\PYG{p}{]}\PYG{p}{,}
    \PYG{n+nx}{on\PYGZus{}finish}\PYG{o}{:} \PYG{k+kd}{function}\PYG{p}{(}\PYG{p}{)} \PYG{p}{\PYGZob{}}
        \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{data}\PYG{p}{.}\PYG{n+nx}{displayData}\PYG{p}{(}\PYG{p}{)}\PYG{p}{;}
    \PYG{p}{\PYGZcb{}}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}


\chapter{Data saving example}
\label{\detokenize{datasaving:data-saving-example}}\label{\detokenize{datasaving:datasaving}}\label{\detokenize{datasaving::doc}}
Code on the server (to receive the data). Replace \sphinxcode{\sphinxupquote{UUN}} with your username.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+cp}{\PYGZlt{}?php}
\PYG{n+nv}{\PYGZdl{}json} \PYG{o}{=} \PYG{n+nb}{file\PYGZus{}get\PYGZus{}contents}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}php://input\PYGZsq{}}\PYG{p}{);}
\PYG{n+nv}{\PYGZdl{}obj} \PYG{o}{=} \PYG{n+nb}{json\PYGZus{}decode}\PYG{p}{(}\PYG{n+nv}{\PYGZdl{}json}\PYG{p}{,} \PYG{k}{true}\PYG{p}{);}
\PYG{n+nv}{\PYGZdl{}outfile} \PYG{o}{=} \PYG{n+nb}{fopen}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}/home/UUN/server\PYGZus{}data/\PYGZsq{}}\PYG{o}{.}\PYG{n+nv}{\PYGZdl{}obj}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{filename}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{],} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{a}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{);}
\PYG{n+nb}{fwrite}\PYG{p}{(}
    \PYG{n+nv}{\PYGZdl{}outfile}\PYG{p}{,}
    \PYG{n+nb}{sprintf}\PYG{p}{(}\PYG{n+nv}{\PYGZdl{}obj}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{filedata}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{])}
\PYG{p}{);}
\PYG{n+nb}{fclose}\PYG{p}{(}\PYG{n+nv}{\PYGZdl{}outfile}\PYG{p}{);}
\PYG{c+cp}{?\PYGZgt{}}
\end{sphinxVerbatim}

The experiment (which sends the data).

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kd}{var} \PYG{n+nx}{factors} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}Dog1.jpg\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}Dog2.jpg\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}Dog3.jpg\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}
    \PYG{n+nx}{stimulus\PYGZus{}duration}\PYG{o}{:} \PYG{p}{[}\PYG{l+m+mi}{400}\PYG{p}{,} \PYG{l+m+mi}{800}\PYG{p}{,} \PYG{l+m+mi}{1200}\PYG{p}{]}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}

\PYG{k+kd}{var} \PYG{n+nx}{factorial\PYGZus{}values} \PYG{o}{=} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{randomization}\PYG{p}{.}\PYG{n+nx}{factorial}\PYG{p}{(}\PYG{n+nx}{factors}\PYG{p}{)}\PYG{p}{;}

\PYG{k+kd}{var} \PYG{n+nx}{trial} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{n+nx}{type}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}image\PYGZhy{}keyboard\PYGZhy{}response\PYGZsq{}}\PYG{p}{,}
    \PYG{n+nx}{prompt}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}\PYGZlt{}p\PYGZgt{}Press a key!\PYGZlt{}/p\PYGZgt{}\PYGZsq{}}\PYG{p}{,}
    \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{timelineVariable}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}stimulus\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
    \PYG{n+nx}{stimulus\PYGZus{}duration}\PYG{o}{:} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{timelineVariable}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}stimulus\PYGZus{}duration\PYGZsq{}}\PYG{p}{)}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}

\PYG{k+kd}{var} \PYG{n+nx}{trials\PYGZus{}with\PYGZus{}variables} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{n+nx}{timeline}\PYG{o}{:} \PYG{p}{[}\PYG{n+nx}{trial}\PYG{p}{]}\PYG{p}{,}
    \PYG{n+nx}{timeline\PYGZus{}variables}\PYG{o}{:} \PYG{n+nx}{factorial\PYGZus{}values}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}

\PYG{k+kd}{function} \PYG{n+nx}{saveData}\PYG{p}{(}\PYG{n+nx}{name}\PYG{p}{,} \PYG{n+nx}{data\PYGZus{}in}\PYG{p}{)}\PYG{p}{\PYGZob{}}
    \PYG{k+kd}{var} \PYG{n+nx}{url} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}record\PYGZus{}result.php\PYGZsq{}}\PYG{p}{;}
    \PYG{k+kd}{var} \PYG{n+nx}{data\PYGZus{}to\PYGZus{}send} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{n+nx}{filename}\PYG{o}{:} \PYG{n+nx}{name}\PYG{p}{,} \PYG{n+nx}{filedata}\PYG{o}{:} \PYG{n+nx}{data\PYGZus{}in}\PYG{p}{\PYGZcb{}}\PYG{p}{;}
    \PYG{n+nx}{fetch}\PYG{p}{(}\PYG{n+nx}{url}\PYG{p}{,} \PYG{p}{\PYGZob{}}
        \PYG{n+nx}{method}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}POST\PYGZsq{}}\PYG{p}{,}
        \PYG{n+nx}{body}\PYG{o}{:} \PYG{n+nx}{JSON}\PYG{p}{.}\PYG{n+nx}{stringify}\PYG{p}{(}\PYG{n+nx}{data\PYGZus{}to\PYGZus{}send}\PYG{p}{)}\PYG{p}{,}
        \PYG{n+nx}{headers}\PYG{o}{:} \PYG{k}{new} \PYG{n+nx}{Headers}\PYG{p}{(}\PYG{p}{\PYGZob{}}
                \PYG{l+s+s1}{\PYGZsq{}Content\PYGZhy{}Type\PYGZsq{}}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}application/json\PYGZsq{}}
        \PYG{p}{\PYGZcb{}}\PYG{p}{)}
    \PYG{p}{\PYGZcb{}}\PYG{p}{)}\PYG{p}{;}
\PYG{p}{\PYGZcb{}}

\PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{init}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{n+nx}{timeline}\PYG{o}{:} \PYG{p}{[}\PYG{n+nx}{trials\PYGZus{}with\PYGZus{}variables}\PYG{p}{]}\PYG{p}{,}
    \PYG{n+nx}{on\PYGZus{}finish}\PYG{o}{:} \PYG{k+kd}{function}\PYG{p}{(}\PYG{p}{)} \PYG{p}{\PYGZob{}}
        \PYG{k+kd}{var} \PYG{n+nx}{experiment\PYGZus{}data} \PYG{o}{=} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{data}\PYG{p}{.}\PYG{n+nx}{get}\PYG{p}{(}\PYG{p}{)}\PYG{p}{;}
        \PYG{n+nx}{saveData}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}test.csv\PYGZdq{}}\PYG{p}{,} \PYG{n+nx}{experiment\PYGZus{}data}\PYG{p}{.}\PYG{n+nx}{csv}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{p}{;}
    \PYG{p}{\PYGZcb{}}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}


\chapter{Line\sphinxhyphen{}by\sphinxhyphen{}line data saving example}
\label{\detokenize{linebyline:line-by-line-data-saving-example}}\label{\detokenize{linebyline:linebyline}}\label{\detokenize{linebyline::doc}}
\begin{sphinxadmonition}{warning}{Warning:}
Make sure that your HTML file loads two plugins:
\sphinxcode{\sphinxupquote{jspsych\sphinxhyphen{}html\sphinxhyphen{}keyboard\sphinxhyphen{}response}} and \sphinxcode{\sphinxupquote{jspsych\sphinxhyphen{}image\sphinxhyphen{}keyboard\sphinxhyphen{}response}}.
\end{sphinxadmonition}

You should have \sphinxcode{\sphinxupquote{record\_result.php}} on the server to receive the data. See {\hyperref[\detokenize{record_result::doc}]{\sphinxcrossref{\DUrole{doc}{this page}}}}.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kd}{var} \PYG{n+nx}{factors} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}Dog1.jpg\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}Dog2.jpg\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}Dog3.jpg\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}
    \PYG{n+nx}{stimulus\PYGZus{}duration}\PYG{o}{:} \PYG{p}{[}\PYG{l+m+mi}{400}\PYG{p}{,} \PYG{l+m+mi}{800}\PYG{p}{,} \PYG{l+m+mi}{1200}\PYG{p}{]}\PYG{p}{,}
    \PYG{n+nx}{fixation\PYGZus{}duration}\PYG{o}{:} \PYG{p}{[}\PYG{l+m+mi}{500}\PYG{p}{,} \PYG{l+m+mi}{1000}\PYG{p}{,} \PYG{l+m+mi}{1500}\PYG{p}{]}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}

\PYG{k+kd}{var} \PYG{n+nx}{factorial\PYGZus{}values} \PYG{o}{=} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{randomization}\PYG{p}{.}\PYG{n+nx}{factorial}\PYG{p}{(}\PYG{n+nx}{factors}\PYG{p}{)}\PYG{p}{;}

\PYG{c+c1}{// adding a \PYGZsq{}data\PYGZsq{} field gives us extra values which:}
\PYG{c+c1}{// \PYGZhy{} are saved automatically if we save the whole dataset at the end}
\PYG{c+c1}{// \PYGZhy{} are accessible in saveDataLine if we save line\PYGZhy{}by\PYGZhy{}line}
\PYG{k+kd}{var} \PYG{n+nx}{fixation} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{n+nx}{type}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}html\PYGZhy{}keyboard\PYGZhy{}response\PYGZsq{}}\PYG{p}{,}
    \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}+\PYGZsq{}}\PYG{p}{,}
    \PYG{n+nx}{trial\PYGZus{}duration}\PYG{o}{:} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{timelineVariable}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}fixation\PYGZus{}duration\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
    \PYG{n+nx}{response\PYGZus{}ends\PYGZus{}trial}\PYG{o}{:} \PYG{k+kc}{false}\PYG{p}{,}
    \PYG{n+nx}{data}\PYG{o}{:} \PYG{p}{\PYGZob{}}
        \PYG{n+nx}{type}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}fixation\PYGZsq{}}
    \PYG{p}{\PYGZcb{}}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}

\PYG{c+c1}{// fixation\PYGZus{}duration is put into the \PYGZsq{}data\PYGZsq{} field for this node as this}
\PYG{c+c1}{// is the one we report at the end \PYGZhy{}\PYGZhy{} fixation nodes are filtered out}
\PYG{k+kd}{var} \PYG{n+nx}{trial} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{n+nx}{type}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}image\PYGZhy{}keyboard\PYGZhy{}response\PYGZsq{}}\PYG{p}{,}
    \PYG{n+nx}{prompt}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}\PYGZlt{}p\PYGZgt{}Press a key!\PYGZlt{}/p\PYGZgt{}\PYGZsq{}}\PYG{p}{,}
    \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{timelineVariable}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}stimulus\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
    \PYG{n+nx}{stimulus\PYGZus{}duration}\PYG{o}{:} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{timelineVariable}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}stimulus\PYGZus{}duration\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
    \PYG{n+nx}{data}\PYG{o}{:} \PYG{p}{\PYGZob{}}
        \PYG{n+nx}{type}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}trial\PYGZsq{}}\PYG{p}{,}
        \PYG{n+nx}{stimulus\PYGZus{}duration}\PYG{o}{:} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{timelineVariable}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}stimulus\PYGZus{}duration\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
        \PYG{n+nx}{fixation\PYGZus{}duration}\PYG{o}{:} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{timelineVariable}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}fixation\PYGZus{}duration\PYGZsq{}}\PYG{p}{)}
    \PYG{p}{\PYGZcb{}}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}

\PYG{k+kd}{var} \PYG{n+nx}{trials\PYGZus{}with\PYGZus{}variables} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{n+nx}{timeline}\PYG{o}{:} \PYG{p}{[}\PYG{n+nx}{fixation}\PYG{p}{,} \PYG{n+nx}{trial}\PYG{p}{]}\PYG{p}{,}
    \PYG{n+nx}{timeline\PYGZus{}variables}\PYG{o}{:} \PYG{n+nx}{factorial\PYGZus{}values}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}

\PYG{k+kd}{function} \PYG{n+nx}{saveData}\PYG{p}{(}\PYG{n+nx}{name}\PYG{p}{,} \PYG{n+nx}{data\PYGZus{}in}\PYG{p}{)}\PYG{p}{\PYGZob{}}
    \PYG{c+c1}{// this is exactly the same as in the previous example}
    \PYG{c+c1}{// (all it does is send data to the server!)}
    \PYG{k+kd}{var} \PYG{n+nx}{url} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}record\PYGZus{}result.php\PYGZsq{}}\PYG{p}{;}
    \PYG{k+kd}{var} \PYG{n+nx}{data\PYGZus{}to\PYGZus{}send} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{n+nx}{filename}\PYG{o}{:} \PYG{n+nx}{name}\PYG{p}{,} \PYG{n+nx}{filedata}\PYG{o}{:} \PYG{n+nx}{data\PYGZus{}in}\PYG{p}{\PYGZcb{}}\PYG{p}{;}
    \PYG{n+nx}{fetch}\PYG{p}{(}\PYG{n+nx}{url}\PYG{p}{,} \PYG{p}{\PYGZob{}}
        \PYG{n+nx}{method}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}POST\PYGZsq{}}\PYG{p}{,}
        \PYG{n+nx}{body}\PYG{o}{:} \PYG{n+nx}{JSON}\PYG{p}{.}\PYG{n+nx}{stringify}\PYG{p}{(}\PYG{n+nx}{data\PYGZus{}to\PYGZus{}send}\PYG{p}{)}\PYG{p}{,}
        \PYG{n+nx}{headers}\PYG{o}{:} \PYG{k}{new} \PYG{n+nx}{Headers}\PYG{p}{(}\PYG{p}{\PYGZob{}}
                \PYG{l+s+s1}{\PYGZsq{}Content\PYGZhy{}Type\PYGZsq{}}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}application/json\PYGZsq{}}
        \PYG{p}{\PYGZcb{}}\PYG{p}{)}
    \PYG{p}{\PYGZcb{}}\PYG{p}{)}\PYG{p}{;}
\PYG{p}{\PYGZcb{}}

\PYG{k+kd}{function} \PYG{n+nx}{saveDataLine}\PYG{p}{(}\PYG{n+nx}{data}\PYG{p}{)} \PYG{p}{\PYGZob{}}
    \PYG{c+c1}{// if this isn\PYGZsq{}t a trial node, return from the function (i.e. no action)}
    \PYG{k}{if} \PYG{p}{(}\PYG{n+nx}{data}\PYG{p}{.}\PYG{n+nx}{type} \PYG{o}{!=} \PYG{l+s+s1}{\PYGZsq{}trial\PYGZsq{}}\PYG{p}{)} \PYG{p}{\PYGZob{}}
        \PYG{k}{return}\PYG{p}{;}
    \PYG{p}{\PYGZcb{}}
    \PYG{c+c1}{// choose the data we want to save}
    \PYG{k+kd}{var} \PYG{n+nx}{data\PYGZus{}to\PYGZus{}save} \PYG{o}{=} \PYG{p}{[}
        \PYG{n+nx}{data}\PYG{p}{.}\PYG{n+nx}{type}\PYG{p}{,} \PYG{n+nx}{data}\PYG{p}{.}\PYG{n+nx}{stimulus}\PYG{p}{,} \PYG{n+nx}{data}\PYG{p}{.}\PYG{n+nx}{stimulus\PYGZus{}duration}\PYG{p}{,} \PYG{n+nx}{data}\PYG{p}{.}\PYG{n+nx}{fixation\PYGZus{}duration}\PYG{p}{,} \PYG{n+nx}{data}\PYG{p}{.}\PYG{n+nx}{rt}
    \PYG{p}{]}\PYG{p}{;}
    \PYG{c+c1}{// join these with commas and add a newline}
    \PYG{k+kd}{var} \PYG{n+nx}{line} \PYG{o}{=} \PYG{n+nx}{data\PYGZus{}to\PYGZus{}save}\PYG{p}{.}\PYG{n+nx}{join}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{},\PYGZsq{}}\PYG{p}{)}\PYG{o}{+}\PYG{l+s+s2}{\PYGZdq{}\PYGZbs{}n\PYGZdq{}}\PYG{p}{;}
    \PYG{n+nx}{saveData}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}test.csv\PYGZdq{}}\PYG{p}{,} \PYG{n+nx}{line}\PYG{p}{)}\PYG{p}{;}
\PYG{p}{\PYGZcb{}}

\PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{init}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{n+nx}{timeline}\PYG{o}{:} \PYG{p}{[}\PYG{n+nx}{trials\PYGZus{}with\PYGZus{}variables}\PYG{p}{]}\PYG{p}{,}
    \PYG{n+nx}{on\PYGZus{}data\PYGZus{}update}\PYG{o}{:} \PYG{n+nx}{saveDataLine}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}


\chapter{Solution to survey\sphinxhyphen{}text exercise}
\label{\detokenize{surveytext:solution-to-survey-text-exercise}}\label{\detokenize{surveytext:surveytext}}\label{\detokenize{surveytext::doc}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kd}{var} \PYG{n+nx}{factors} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}Dog1.jpg\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}Dog2.jpg\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}Dog3.jpg\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}
    \PYG{n+nx}{stimulus\PYGZus{}duration}\PYG{o}{:} \PYG{p}{[}\PYG{l+m+mi}{400}\PYG{p}{,} \PYG{l+m+mi}{800}\PYG{p}{,} \PYG{l+m+mi}{1200}\PYG{p}{]}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}

\PYG{k+kd}{var} \PYG{n+nx}{factorial\PYGZus{}values} \PYG{o}{=} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{randomization}\PYG{p}{.}\PYG{n+nx}{factorial}\PYG{p}{(}\PYG{n+nx}{factors}\PYG{p}{)}\PYG{p}{;}

\PYG{k+kd}{var} \PYG{n+nx}{get\PYGZus{}id} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{n+nx}{type}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}survey\PYGZhy{}text\PYGZsq{}}\PYG{p}{,}
    \PYG{n+nx}{questions}\PYG{o}{:} \PYG{p}{[}\PYG{p}{\PYGZob{}}\PYG{n+nx}{prompt}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}What is your ID?\PYGZsq{}}\PYG{p}{\PYGZcb{}}\PYG{p}{]}\PYG{p}{,}
    \PYG{n+nx}{on\PYGZus{}finish}\PYG{o}{:} \PYG{k+kd}{function}\PYG{p}{(}\PYG{n+nx}{data}\PYG{p}{)} \PYG{p}{\PYGZob{}}
        \PYG{k+kd}{var} \PYG{n+nx}{response} \PYG{o}{=} \PYG{n+nx}{JSON}\PYG{p}{.}\PYG{n+nx}{parse}\PYG{p}{(}\PYG{n+nx}{data}\PYG{p}{.}\PYG{n+nx}{responses}\PYG{p}{)}\PYG{p}{.}\PYG{n+nx}{Q0}\PYG{p}{;}
        \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{data}\PYG{p}{.}\PYG{n+nx}{addProperties}\PYG{p}{(}\PYG{p}{\PYGZob{}} \PYG{n+nx}{id}\PYG{o}{:} \PYG{n+nx}{response} \PYG{p}{\PYGZcb{}}\PYG{p}{)}\PYG{p}{;}
    \PYG{p}{\PYGZcb{}}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}

\PYG{k+kd}{var} \PYG{n+nx}{trial} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{n+nx}{type}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}image\PYGZhy{}keyboard\PYGZhy{}response\PYGZsq{}}\PYG{p}{,}
    \PYG{n+nx}{prompt}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}\PYGZlt{}p\PYGZgt{}Press a key!\PYGZlt{}/p\PYGZgt{}\PYGZsq{}}\PYG{p}{,}
    \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{timelineVariable}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}stimulus\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
    \PYG{n+nx}{stimulus\PYGZus{}duration}\PYG{o}{:} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{timelineVariable}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}stimulus\PYGZus{}duration\PYGZsq{}}\PYG{p}{)}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}

\PYG{k+kd}{var} \PYG{n+nx}{trials\PYGZus{}with\PYGZus{}variables} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{n+nx}{timeline}\PYG{o}{:} \PYG{p}{[}\PYG{n+nx}{trial}\PYG{p}{]}\PYG{p}{,}
    \PYG{n+nx}{timeline\PYGZus{}variables}\PYG{o}{:} \PYG{n+nx}{factorial\PYGZus{}values}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}

\PYG{k+kd}{function} \PYG{n+nx}{saveData}\PYG{p}{(}\PYG{n+nx}{name}\PYG{p}{,} \PYG{n+nx}{data\PYGZus{}in}\PYG{p}{)}\PYG{p}{\PYGZob{}}
    \PYG{k+kd}{var} \PYG{n+nx}{url} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}record\PYGZus{}result.php\PYGZsq{}}\PYG{p}{;}
    \PYG{k+kd}{var} \PYG{n+nx}{data\PYGZus{}to\PYGZus{}send} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{n+nx}{filename}\PYG{o}{:} \PYG{n+nx}{name}\PYG{p}{,} \PYG{n+nx}{filedata}\PYG{o}{:} \PYG{n+nx}{data\PYGZus{}in}\PYG{p}{\PYGZcb{}}\PYG{p}{;}
    \PYG{n+nx}{fetch}\PYG{p}{(}\PYG{n+nx}{url}\PYG{p}{,} \PYG{p}{\PYGZob{}}
        \PYG{n+nx}{method}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}POST\PYGZsq{}}\PYG{p}{,}
        \PYG{n+nx}{body}\PYG{o}{:} \PYG{n+nx}{JSON}\PYG{p}{.}\PYG{n+nx}{stringify}\PYG{p}{(}\PYG{n+nx}{data\PYGZus{}to\PYGZus{}send}\PYG{p}{)}\PYG{p}{,}
        \PYG{n+nx}{headers}\PYG{o}{:} \PYG{k}{new} \PYG{n+nx}{Headers}\PYG{p}{(}\PYG{p}{\PYGZob{}}
                \PYG{l+s+s1}{\PYGZsq{}Content\PYGZhy{}Type\PYGZsq{}}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}application/json\PYGZsq{}}
        \PYG{p}{\PYGZcb{}}\PYG{p}{)}
    \PYG{p}{\PYGZcb{}}\PYG{p}{)}\PYG{p}{;}
\PYG{p}{\PYGZcb{}}

\PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{init}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{n+nx}{timeline}\PYG{o}{:} \PYG{p}{[}\PYG{n+nx}{get\PYGZus{}id}\PYG{p}{,} \PYG{n+nx}{trials\PYGZus{}with\PYGZus{}variables}\PYG{p}{]}\PYG{p}{,}
    \PYG{n+nx}{on\PYGZus{}finish}\PYG{o}{:} \PYG{k+kd}{function}\PYG{p}{(}\PYG{p}{)} \PYG{p}{\PYGZob{}}
        \PYG{k+kd}{var} \PYG{n+nx}{experiment\PYGZus{}data} \PYG{o}{=} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{data}\PYG{p}{.}\PYG{n+nx}{get}\PYG{p}{(}\PYG{p}{)}\PYG{p}{;}
        \PYG{n+nx}{saveData}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}test.csv\PYGZdq{}}\PYG{p}{,} \PYG{n+nx}{experiment\PYGZus{}data}\PYG{p}{.}\PYG{n+nx}{csv}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{p}{;}
    \PYG{p}{\PYGZcb{}}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}


\chapter{PHP code to receive data on the server}
\label{\detokenize{record_result:php-code-to-receive-data-on-the-server}}\label{\detokenize{record_result::doc}}
Note that:
\begin{itemize}
\item {} 
You \sphinxstylestrong{must} replace \sphinxcode{\sphinxupquote{UUN}} with your username.

\item {} 
Throughout all the examples, this file is given the name \sphinxcode{\sphinxupquote{record\_result.php}}.

\item {} 
The line \sphinxcode{\sphinxupquote{\$outfile = fopen(\$path, "a");}} opens the file in “append” mode, which means results will always be appended to the file. If you want this code to always write a new file (possibly replacing the old one), change the \sphinxcode{\sphinxupquote{"a"}} to \sphinxcode{\sphinxupquote{"w"}}.

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+cp}{\PYGZlt{}?php}
\PYG{n+nv}{\PYGZdl{}json} \PYG{o}{=} \PYG{n+nb}{file\PYGZus{}get\PYGZus{}contents}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}php://input\PYGZsq{}}\PYG{p}{);}
\PYG{n+nv}{\PYGZdl{}obj} \PYG{o}{=} \PYG{n+nb}{json\PYGZus{}decode}\PYG{p}{(}\PYG{n+nv}{\PYGZdl{}json}\PYG{p}{,} \PYG{k}{true}\PYG{p}{);}
\PYG{n+nv}{\PYGZdl{}server\PYGZus{}data} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}/home/UUN/server\PYGZus{}data\PYGZsq{}}\PYG{p}{;}
\PYG{n+nv}{\PYGZdl{}path} \PYG{o}{=} \PYG{n+nv}{\PYGZdl{}server\PYGZus{}data}\PYG{o}{.}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{/}\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n+nv}{\PYGZdl{}obj}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{filename}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{];}
\PYG{k}{if} \PYG{p}{(}\PYG{n+nb}{substr}\PYG{p}{(}\PYG{n+nb}{realpath}\PYG{p}{(}\PYG{n+nb}{dirname}\PYG{p}{(}\PYG{n+nv}{\PYGZdl{}path}\PYG{p}{)),} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{n+nb}{strlen}\PYG{p}{(}\PYG{n+nv}{\PYGZdl{}server\PYGZus{}data}\PYG{p}{))}\PYG{o}{!=}\PYG{n+nv}{\PYGZdl{}server\PYGZus{}data}\PYG{p}{)} \PYG{p}{\PYGZob{}}
    \PYG{n+nb}{error\PYGZus{}log}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{attempt to write to bad path: }\PYG{l+s+s2}{\PYGZdq{}}\PYG{o}{.}\PYG{n+nv}{\PYGZdl{}path}\PYG{p}{);}
\PYG{p}{\PYGZcb{}} \PYG{k}{else} \PYG{p}{\PYGZob{}}
    \PYG{n+nv}{\PYGZdl{}outfile} \PYG{o}{=} \PYG{n+nb}{fopen}\PYG{p}{(}\PYG{n+nv}{\PYGZdl{}path}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{a}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{);}
    \PYG{n+nb}{fwrite}\PYG{p}{(}
        \PYG{n+nv}{\PYGZdl{}outfile}\PYG{p}{,}
        \PYG{n+nb}{sprintf}\PYG{p}{(}\PYG{n+nv}{\PYGZdl{}obj}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{filedata}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{])}
    \PYG{p}{);}
    \PYG{n+nb}{fclose}\PYG{p}{(}\PYG{n+nv}{\PYGZdl{}outfile}\PYG{p}{);}
\PYG{p}{\PYGZcb{}}
\PYG{c+cp}{?\PYGZgt{}}
\end{sphinxVerbatim}


\chapter{Example}
\label{\detokenize{pptcondition:example}}\label{\detokenize{pptcondition:pptcondition}}\label{\detokenize{pptcondition::doc}}
This example demonstrates gathering a participant number
from the URL, calculating a condition number, and adding the participant number
and the date to the data filename.

\sphinxcode{\sphinxupquote{record\_result.php}} as given \DUrole{xref,std,std-ref}{here}.

In \sphinxcode{\sphinxupquote{experiment.js}}:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{// e.g. with three conditions}
\PYG{k+kd}{var} \PYG{n+nx}{participant\PYGZus{}id} \PYG{o}{=} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{data}\PYG{p}{.}\PYG{n+nx}{getURLVariable}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}participant\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
\PYG{k+kd}{var} \PYG{n+nx}{condition\PYGZus{}number} \PYG{o}{=} \PYG{n+nx}{participant\PYGZus{}id} \PYG{o}{\PYGZpc{}} \PYG{l+m+mi}{3}\PYG{p}{;}
\PYG{k}{if} \PYG{p}{(}\PYG{n+nx}{condition\PYGZus{}number} \PYG{o}{==} \PYG{l+m+mi}{0}\PYG{p}{)} \PYG{p}{\PYGZob{}}
    \PYG{n+nx}{condition\PYGZus{}number} \PYG{o}{=} \PYG{l+m+mi}{3}\PYG{p}{;}
\PYG{p}{\PYGZcb{}}
\PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{data}\PYG{p}{.}\PYG{n+nx}{addProperties}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{n+nx}{participant}\PYG{o}{:} \PYG{n+nx}{participant\PYGZus{}id}\PYG{p}{,}
    \PYG{n+nx}{condition}\PYG{o}{:} \PYG{n+nx}{condition\PYGZus{}number}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}\PYG{p}{;}

\PYG{k+kd}{var} \PYG{n+nx}{factors} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}Dog1.jpg\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}Dog2.jpg\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}Dog3.jpg\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}
    \PYG{n+nx}{stimulus\PYGZus{}duration}\PYG{o}{:} \PYG{p}{[}\PYG{l+m+mi}{400}\PYG{p}{,} \PYG{l+m+mi}{800}\PYG{p}{,} \PYG{l+m+mi}{1200}\PYG{p}{]}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}

\PYG{k+kd}{var} \PYG{n+nx}{factorial\PYGZus{}values} \PYG{o}{=} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{randomization}\PYG{p}{.}\PYG{n+nx}{factorial}\PYG{p}{(}\PYG{n+nx}{factors}\PYG{p}{)}\PYG{p}{;}

\PYG{k+kd}{var} \PYG{n+nx}{trial} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{n+nx}{type}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}image\PYGZhy{}keyboard\PYGZhy{}response\PYGZsq{}}\PYG{p}{,}
    \PYG{n+nx}{prompt}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}\PYGZlt{}p\PYGZgt{}Press a key!\PYGZlt{}/p\PYGZgt{}\PYGZsq{}}\PYG{p}{,}
    \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{timelineVariable}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}stimulus\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
    \PYG{n+nx}{stimulus\PYGZus{}duration}\PYG{o}{:} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{timelineVariable}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}stimulus\PYGZus{}duration\PYGZsq{}}\PYG{p}{)}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}

\PYG{k+kd}{var} \PYG{n+nx}{trials\PYGZus{}with\PYGZus{}variables} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{n+nx}{timeline}\PYG{o}{:} \PYG{p}{[}\PYG{n+nx}{trial}\PYG{p}{]}\PYG{p}{,}
    \PYG{n+nx}{timeline\PYGZus{}variables}\PYG{o}{:} \PYG{n+nx}{factorial\PYGZus{}values}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}

\PYG{k+kd}{function} \PYG{n+nx}{saveData}\PYG{p}{(}\PYG{n+nx}{name}\PYG{p}{,} \PYG{n+nx}{data\PYGZus{}in}\PYG{p}{)}\PYG{p}{\PYGZob{}}
    \PYG{k+kd}{var} \PYG{n+nx}{url} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}record\PYGZus{}result.php\PYGZsq{}}\PYG{p}{;}
    \PYG{k+kd}{var} \PYG{n+nx}{data\PYGZus{}in} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{n+nx}{filename}\PYG{o}{:} \PYG{n+nx}{name}\PYG{p}{,} \PYG{n+nx}{filedata}\PYG{o}{:} \PYG{n+nx}{data\PYGZus{}to\PYGZus{}send}\PYG{p}{\PYGZcb{}}\PYG{p}{;}
    \PYG{n+nx}{fetch}\PYG{p}{(}\PYG{n+nx}{url}\PYG{p}{,} \PYG{p}{\PYGZob{}}
        \PYG{n+nx}{method}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}POST\PYGZsq{}}\PYG{p}{,}
        \PYG{n+nx}{body}\PYG{o}{:} \PYG{n+nx}{JSON}\PYG{p}{.}\PYG{n+nx}{stringify}\PYG{p}{(}\PYG{n+nx}{data\PYGZus{}to\PYGZus{}send}\PYG{p}{)}\PYG{p}{,}
        \PYG{n+nx}{headers}\PYG{o}{:} \PYG{k}{new} \PYG{n+nx}{Headers}\PYG{p}{(}\PYG{p}{\PYGZob{}}
                \PYG{l+s+s1}{\PYGZsq{}Content\PYGZhy{}Type\PYGZsq{}}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}application/json\PYGZsq{}}
        \PYG{p}{\PYGZcb{}}\PYG{p}{)}
    \PYG{p}{\PYGZcb{}}\PYG{p}{)}\PYG{p}{;}
\PYG{p}{\PYGZcb{}}

\PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{init}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{n+nx}{timeline}\PYG{o}{:} \PYG{p}{[}\PYG{n+nx}{trials\PYGZus{}with\PYGZus{}variables}\PYG{p}{]}\PYG{p}{,}
    \PYG{n+nx}{on\PYGZus{}finish}\PYG{o}{:} \PYG{k+kd}{function}\PYG{p}{(}\PYG{p}{)} \PYG{p}{\PYGZob{}}
        \PYG{k+kd}{var} \PYG{n+nx}{experiment\PYGZus{}data} \PYG{o}{=} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{data}\PYG{p}{.}\PYG{n+nx}{get}\PYG{p}{(}\PYG{p}{)}\PYG{p}{;}
        \PYG{n+nx}{saveData}\PYG{p}{(}\PYG{n+nx}{participant\PYGZus{}id}\PYG{o}{+}\PYG{l+s+s2}{\PYGZdq{}\PYGZus{}data.csv\PYGZdq{}}\PYG{p}{,} \PYG{n+nx}{experiment\PYGZus{}data}\PYG{p}{.}\PYG{n+nx}{csv}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{p}{;}
    \PYG{p}{\PYGZcb{}}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}


\chapter{Multiple images}
\label{\detokenize{multiple_images:multiple-images}}\label{\detokenize{multiple_images:id1}}\label{\detokenize{multiple_images::doc}}
This code uses \sphinxcode{\sphinxupquote{jspsych\sphinxhyphen{}html\sphinxhyphen{}keyboard\sphinxhyphen{}response}}, so make sure it’s included in your
\sphinxcode{\sphinxupquote{experiment.html}}.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{// create a list of all images so we can tell jsPsych to}
\PYG{c+c1}{// preload them for speed (see jsPsych.init below)}
\PYG{k+kd}{var} \PYG{n+nx}{cats} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}Cat1.jpg\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}Cat2.jpg\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}Cat3.jpg\PYGZsq{}}\PYG{p}{]}\PYG{p}{;}
\PYG{k+kd}{var} \PYG{n+nx}{dogs} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}Dog1.jpg\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}Dog2.jpg\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}Dog3.jpg\PYGZsq{}}\PYG{p}{]}\PYG{p}{;}
\PYG{k+kd}{var} \PYG{n+nx}{all\PYGZus{}images} \PYG{o}{=} \PYG{n+nx}{cats}\PYG{p}{.}\PYG{n+nx}{concat}\PYG{p}{(}\PYG{n+nx}{dogs}\PYG{p}{)}\PYG{p}{;}

\PYG{c+c1}{// this example uses fewer durations (just to make the number}
\PYG{c+c1}{// of trials sensible).}
\PYG{k+kd}{var} \PYG{n+nx}{factors} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{n+nx}{image1}\PYG{o}{:} \PYG{n+nx}{cats}\PYG{p}{,}
    \PYG{n+nx}{image2}\PYG{o}{:} \PYG{n+nx}{dogs}\PYG{p}{,}
    \PYG{n+nx}{stimulus\PYGZus{}duration}\PYG{o}{:} \PYG{p}{[}\PYG{l+m+mi}{750}\PYG{p}{,} \PYG{l+m+mi}{1500}\PYG{p}{]}\PYG{p}{,}
    \PYG{n+nx}{fixation\PYGZus{}duration}\PYG{o}{:} \PYG{p}{[}\PYG{l+m+mi}{250}\PYG{p}{,} \PYG{l+m+mi}{500}\PYG{p}{]}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}

\PYG{k+kd}{var} \PYG{n+nx}{factorial\PYGZus{}values} \PYG{o}{=} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{randomization}\PYG{p}{.}\PYG{n+nx}{factorial}\PYG{p}{(}\PYG{n+nx}{factors}\PYG{p}{)}\PYG{p}{;}

\PYG{k+kd}{var} \PYG{n+nx}{fixation} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{n+nx}{type}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}html\PYGZhy{}keyboard\PYGZhy{}response\PYGZsq{}}\PYG{p}{,}
    \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}+\PYGZsq{}}\PYG{p}{,}
    \PYG{n+nx}{trial\PYGZus{}duration}\PYG{o}{:} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{timelineVariable}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}fixation\PYGZus{}duration\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
    \PYG{n+nx}{response\PYGZus{}ends\PYGZus{}trial}\PYG{o}{:} \PYG{k+kc}{false}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}

\PYG{c+c1}{// add all of the relevant variables to the data field so they}
\PYG{c+c1}{// will appear in the results}
\PYG{k+kd}{var} \PYG{n+nx}{trial} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{n+nx}{type}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}html\PYGZhy{}keyboard\PYGZhy{}response\PYGZsq{}}\PYG{p}{,}
    \PYG{n+nx}{prompt}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}\PYGZlt{}p\PYGZgt{}Press a key!\PYGZlt{}/p\PYGZgt{}\PYGZsq{}}\PYG{p}{,}
    \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{k+kd}{function} \PYG{p}{(}\PYG{p}{)} \PYG{p}{\PYGZob{}}
        \PYG{c+c1}{// note: the outer parentheses are only here so we can break the line}
        \PYG{k}{return} \PYG{p}{(}
           \PYG{l+s+s1}{\PYGZsq{}\PYGZlt{}img src=\PYGZdq{}\PYGZsq{}}\PYG{o}{+}\PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{timelineVariable}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}image1\PYGZdq{}}\PYG{p}{,} \PYG{k+kc}{true}\PYG{p}{)}\PYG{o}{+}\PYG{l+s+s1}{\PYGZsq{}\PYGZdq{}\PYGZgt{}\PYGZsq{}}
           \PYG{o}{+}\PYG{l+s+s1}{\PYGZsq{}\PYGZlt{}img src=\PYGZdq{}\PYGZsq{}}\PYG{o}{+}\PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{timelineVariable}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}image2\PYGZdq{}}\PYG{p}{,} \PYG{k+kc}{true}\PYG{p}{)}\PYG{o}{+}\PYG{l+s+s1}{\PYGZsq{}\PYGZdq{}\PYGZgt{}\PYGZsq{}}
        \PYG{p}{)}\PYG{p}{;}
    \PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{n+nx}{stimulus\PYGZus{}duration}\PYG{o}{:} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{timelineVariable}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}stimulus\PYGZus{}duration\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
    \PYG{n+nx}{data}\PYG{o}{:} \PYG{p}{\PYGZob{}}
      \PYG{n+nx}{fixation\PYGZus{}duration}\PYG{o}{:} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{timelineVariable}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}fixation\PYGZus{}duration\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
      \PYG{n+nx}{stimulus\PYGZus{}duration}\PYG{o}{:} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{timelineVariable}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}stimulus\PYGZus{}duration\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
      \PYG{n+nx}{image1}\PYG{o}{:} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{timelineVariable}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}image1\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
      \PYG{n+nx}{image2}\PYG{o}{:} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{timelineVariable}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}image2\PYGZsq{}}\PYG{p}{)}
    \PYG{p}{\PYGZcb{}}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}

\PYG{k+kd}{var} \PYG{n+nx}{trials\PYGZus{}with\PYGZus{}variables} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{n+nx}{timeline}\PYG{o}{:} \PYG{p}{[}\PYG{n+nx}{fixation}\PYG{p}{,} \PYG{n+nx}{trial}\PYG{p}{]}\PYG{p}{,}
    \PYG{n+nx}{timeline\PYGZus{}variables}\PYG{o}{:} \PYG{n+nx}{factorial\PYGZus{}values}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}

\PYG{c+c1}{// add a list of all images, these will be loaded right at the start}
\PYG{c+c1}{// to avoid delays}
\PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{init}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{n+nx}{timeline}\PYG{o}{:} \PYG{p}{[}\PYG{n+nx}{trials\PYGZus{}with\PYGZus{}variables}\PYG{p}{]}\PYG{p}{,}
    \PYG{n+nx}{on\PYGZus{}finish}\PYG{o}{:} \PYG{k+kd}{function}\PYG{p}{(}\PYG{p}{)} \PYG{p}{\PYGZob{}}
        \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{data}\PYG{p}{.}\PYG{n+nx}{displayData}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}csv\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
    \PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{n+nx}{preload\PYGZus{}images}\PYG{o}{:} \PYG{n+nx}{all\PYGZus{}images}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}


\chapter{Multiple images (using a loop)}
\label{\detokenize{multiple_images_loop:multiple-images-using-a-loop}}\label{\detokenize{multiple_images_loop:multiple-images-loop}}\label{\detokenize{multiple_images_loop::doc}}
This code uses \sphinxcode{\sphinxupquote{jspsych\sphinxhyphen{}html\sphinxhyphen{}keyboard\sphinxhyphen{}response}}, so make sure it’s included in your
\sphinxcode{\sphinxupquote{experiment.html}}.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{// create a list of all images so we can tell jsPsych to}
\PYG{c+c1}{// preload them for speed (see jsPsych.init below)}
\PYG{k+kd}{var} \PYG{n+nx}{cats} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}Cat1.jpg\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}Cat2.jpg\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}Cat3.jpg\PYGZsq{}}\PYG{p}{]}\PYG{p}{;}
\PYG{k+kd}{var} \PYG{n+nx}{dogs} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}Dog1.jpg\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}Dog2.jpg\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}Dog3.jpg\PYGZsq{}}\PYG{p}{]}\PYG{p}{;}
\PYG{k+kd}{var} \PYG{n+nx}{all\PYGZus{}images} \PYG{o}{=} \PYG{n+nx}{cats}\PYG{p}{.}\PYG{n+nx}{concat}\PYG{p}{(}\PYG{n+nx}{dogs}\PYG{p}{)}\PYG{p}{;}

\PYG{c+c1}{// this example uses fewer durations (just to make the number}
\PYG{c+c1}{// of trials sensible).}
\PYG{k+kd}{var} \PYG{n+nx}{factors} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{n+nx}{image1}\PYG{o}{:} \PYG{n+nx}{cats}\PYG{p}{,}
    \PYG{n+nx}{image2}\PYG{o}{:} \PYG{n+nx}{dogs}\PYG{p}{,}
    \PYG{n+nx}{stimulus\PYGZus{}duration}\PYG{o}{:} \PYG{p}{[}\PYG{l+m+mi}{750}\PYG{p}{,} \PYG{l+m+mi}{1500}\PYG{p}{]}\PYG{p}{,}
    \PYG{n+nx}{fixation\PYGZus{}duration}\PYG{o}{:} \PYG{p}{[}\PYG{l+m+mi}{250}\PYG{p}{,} \PYG{l+m+mi}{500}\PYG{p}{]}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}

\PYG{k+kd}{var} \PYG{n+nx}{factorial\PYGZus{}values} \PYG{o}{=} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{randomization}\PYG{p}{.}\PYG{n+nx}{factorial}\PYG{p}{(}\PYG{n+nx}{factors}\PYG{p}{)}\PYG{p}{;}

\PYG{k+kd}{var} \PYG{n+nx}{trials} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}\PYG{p}{;}

\PYG{k}{for} \PYG{p}{(}\PYG{n+nx}{values} \PYG{k}{of} \PYG{n+nx}{factorial\PYGZus{}values}\PYG{p}{)} \PYG{p}{\PYGZob{}}
    \PYG{k+kd}{var} \PYG{n+nx}{fixation} \PYG{o}{=} \PYG{p}{\PYGZob{}}
        \PYG{n+nx}{type}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}html\PYGZhy{}keyboard\PYGZhy{}response\PYGZsq{}}\PYG{p}{,}
        \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}+\PYGZsq{}}\PYG{p}{,}
        \PYG{n+nx}{trial\PYGZus{}duration}\PYG{o}{:} \PYG{n+nx}{values}\PYG{p}{.}\PYG{n+nx}{fixation\PYGZus{}duration}\PYG{p}{,}
        \PYG{n+nx}{response\PYGZus{}ends\PYGZus{}trial}\PYG{o}{:} \PYG{k+kc}{false}
    \PYG{p}{\PYGZcb{}}\PYG{p}{;}
    \PYG{n+nx}{trials}\PYG{p}{.}\PYG{n+nx}{push}\PYG{p}{(}\PYG{n+nx}{fixation}\PYG{p}{)}\PYG{p}{;}
    \PYG{c+c1}{// note that when using this approach, the \PYGZsq{}stimulus\PYGZsq{} field doesn\PYGZsq{}t}
    \PYG{c+c1}{// need to be in a function}
    \PYG{k+kd}{var} \PYG{n+nx}{trial} \PYG{o}{=} \PYG{p}{\PYGZob{}}
        \PYG{n+nx}{type}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}html\PYGZhy{}keyboard\PYGZhy{}response\PYGZsq{}}\PYG{p}{,}
        \PYG{n+nx}{prompt}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}\PYGZlt{}p\PYGZgt{}Press a key!\PYGZlt{}/p\PYGZgt{}\PYGZsq{}}\PYG{p}{,}
        \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}\PYGZlt{}img src=\PYGZdq{}\PYGZsq{}}\PYG{o}{+}\PYG{n+nx}{values}\PYG{p}{.}\PYG{n+nx}{image1}\PYG{o}{+}\PYG{l+s+s1}{\PYGZsq{}\PYGZdq{}\PYGZgt{} \PYGZlt{}img src=\PYGZdq{}\PYGZsq{}}\PYG{o}{+}\PYG{n+nx}{values}\PYG{p}{.}\PYG{n+nx}{image2}\PYG{o}{+}\PYG{l+s+s1}{\PYGZsq{}\PYGZdq{}\PYGZgt{}\PYGZsq{}}\PYG{p}{,}
        \PYG{n+nx}{stimulus\PYGZus{}duration}\PYG{o}{:} \PYG{n+nx}{values}\PYG{p}{.}\PYG{n+nx}{stimulus\PYGZus{}duration}\PYG{p}{,}
        \PYG{n+nx}{data}\PYG{o}{:} \PYG{n+nx}{values}
    \PYG{p}{\PYGZcb{}}\PYG{p}{;}
    \PYG{n+nx}{trials}\PYG{p}{.}\PYG{n+nx}{push}\PYG{p}{(}\PYG{n+nx}{trial}\PYG{p}{)}\PYG{p}{;}
        \PYG{c+cm}{/* Note: above we just copy the variable \PYGZsq{}values\PYGZsq{} directly into}
\PYG{c+cm}{           the \PYGZsq{}data\PYGZsq{} field, as it already has the information we need.}
\PYG{c+cm}{           We could copy individual items like this:}
\PYG{c+cm}{           data: \PYGZob{}}
\PYG{c+cm}{               fixation\PYGZus{}duration: values.fixation\PYGZus{}duration,}
\PYG{c+cm}{               stimulus\PYGZus{}duration: values.stimulus\PYGZus{}duration,}
\PYG{c+cm}{               image1: values.image1,}
\PYG{c+cm}{               image2: values.image2}
\PYG{c+cm}{           \PYGZcb{}}
\PYG{c+cm}{           but it would have exactly the same effect. */}
\PYG{p}{\PYGZcb{}}

\PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{init}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{n+nx}{timeline}\PYG{o}{:} \PYG{n+nx}{trials}\PYG{p}{,}
    \PYG{n+nx}{on\PYGZus{}finish}\PYG{o}{:} \PYG{k+kd}{function}\PYG{p}{(}\PYG{p}{)} \PYG{p}{\PYGZob{}}
        \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{data}\PYG{p}{.}\PYG{n+nx}{displayData}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}csv\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
    \PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{n+nx}{preload\PYGZus{}images}\PYG{o}{:} \PYG{n+nx}{all\PYGZus{}images}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}


\chapter{Stroop with timeline variables}
\label{\detokenize{stroop_timeline_variables:stroop-with-timeline-variables}}\label{\detokenize{stroop_timeline_variables:stroop-timeline-variables}}\label{\detokenize{stroop_timeline_variables::doc}}
Example \sphinxcode{\sphinxupquote{experiment.html}}. You may have to change this slightly
depending on the location of your copy of jsPsych on the server.

It contains some extra style information to make the background grey,
and make the text of the stimulus bigger and boldface.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+cp}{\PYGZlt{}!DOCTYPE html\PYGZgt{}}
\PYG{p}{\PYGZlt{}}\PYG{n+nt}{html}\PYG{p}{\PYGZgt{}}
\PYG{p}{\PYGZlt{}}\PYG{n+nt}{head}\PYG{p}{\PYGZgt{}}
    \PYG{p}{\PYGZlt{}}\PYG{n+nt}{title}\PYG{p}{\PYGZgt{}}My experiment\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{title}\PYG{p}{\PYGZgt{}}
    \PYG{p}{\PYGZlt{}}\PYG{n+nt}{script} \PYG{n+na}{src}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}jspsych\PYGZhy{}6.0/jspsych.js\PYGZdq{}}\PYG{p}{\PYGZgt{}}\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{script}\PYG{p}{\PYGZgt{}}
    \PYG{p}{\PYGZlt{}}\PYG{n+nt}{script} \PYG{n+na}{src}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}jspsych\PYGZhy{}6.0/plugins/jspsych\PYGZhy{}html\PYGZhy{}keyboard\PYGZhy{}response.js\PYGZdq{}}\PYG{p}{\PYGZgt{}}\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{script}\PYG{p}{\PYGZgt{}}
    \PYG{p}{\PYGZlt{}}\PYG{n+nt}{script} \PYG{n+na}{src}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}jspsych\PYGZhy{}6.0/plugins/jspsych\PYGZhy{}instructions.js\PYGZdq{}}\PYG{p}{\PYGZgt{}}\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{script}\PYG{p}{\PYGZgt{}}
    \PYG{p}{\PYGZlt{}}\PYG{n+nt}{link} \PYG{n+na}{href}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}jspsych\PYGZhy{}6.0/css/jspsych.css\PYGZdq{}} \PYG{n+na}{rel}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}stylesheet\PYGZdq{}} \PYG{n+na}{type}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}text/css\PYGZdq{}}\PYG{p}{\PYGZgt{}}\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{link}\PYG{p}{\PYGZgt{}}
    \PYG{p}{\PYGZlt{}}\PYG{n+nt}{script} \PYG{n+na}{src}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}experiment.js\PYGZdq{}}\PYG{p}{\PYGZgt{}}\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{script}\PYG{p}{\PYGZgt{}}
    \PYG{p}{\PYGZlt{}}\PYG{n+nt}{style}\PYG{p}{\PYGZgt{}}
      \PYG{n+nt}{body} \PYG{p}{\PYGZob{}}
        \PYG{k}{background\PYGZhy{}color}\PYG{p}{:} \PYG{l+m+mh}{\PYGZsh{}777777}\PYG{p}{;}
      \PYG{p}{\PYGZcb{}}
      \PYG{p}{.}\PYG{n+nc}{jspsych\PYGZhy{}display\PYGZhy{}element} \PYG{p}{\PYGZob{}}
         \PYG{k}{font\PYGZhy{}size}\PYG{p}{:} \PYG{k+kc}{xx\PYGZhy{}large}\PYG{p}{;}
         \PYG{k}{font\PYGZhy{}family}\PYG{p}{:} \PYG{n}{sans}\PYG{p}{;}
         \PYG{k}{font\PYGZhy{}weight}\PYG{p}{:} \PYG{k+kc}{bold}
      \PYG{p}{\PYGZcb{}}
    \PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{style}\PYG{p}{\PYGZgt{}}
\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{head}\PYG{p}{\PYGZgt{}}
\PYG{p}{\PYGZlt{}}\PYG{n+nt}{body}\PYG{p}{\PYGZgt{}}\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{body}\PYG{p}{\PYGZgt{}}
\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{html}\PYG{p}{\PYGZgt{}}
\end{sphinxVerbatim}

And \sphinxcode{\sphinxupquote{experiment.js}}:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kd}{var} \PYG{n+nx}{stroop\PYGZus{}variables} \PYG{o}{=} \PYG{p}{[}
    \PYG{p}{\PYGZob{}} \PYG{n+nx}{colour}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}blue\PYGZdq{}}\PYG{p}{,} \PYG{n+nx}{text}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}blue\PYGZdq{}}\PYG{p}{,} \PYG{n+nx}{condition}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}congruent\PYGZdq{}} \PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}} \PYG{n+nx}{colour}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}red\PYGZdq{}}\PYG{p}{,} \PYG{n+nx}{text}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}red\PYGZdq{}}\PYG{p}{,} \PYG{n+nx}{condition}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}congruent\PYGZdq{}} \PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}} \PYG{n+nx}{colour}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}yellow\PYGZdq{}}\PYG{p}{,} \PYG{n+nx}{text}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}yellow\PYGZdq{}}\PYG{p}{,} \PYG{n+nx}{condition}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}congruent\PYGZdq{}} \PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}} \PYG{n+nx}{colour}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}green\PYGZdq{}}\PYG{p}{,} \PYG{n+nx}{text}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}green\PYGZdq{}}\PYG{p}{,} \PYG{n+nx}{condition}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}congruent\PYGZdq{}} \PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}} \PYG{n+nx}{colour}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}blue\PYGZdq{}}\PYG{p}{,} \PYG{n+nx}{text}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}yellow\PYGZdq{}}\PYG{p}{,} \PYG{n+nx}{condition}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}incongruent\PYGZdq{}} \PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}} \PYG{n+nx}{colour}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}red\PYGZdq{}}\PYG{p}{,} \PYG{n+nx}{text}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}green\PYGZdq{}}\PYG{p}{,} \PYG{n+nx}{condition}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}incongruent\PYGZdq{}} \PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}} \PYG{n+nx}{colour}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}yellow\PYGZdq{}}\PYG{p}{,} \PYG{n+nx}{text}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}blue\PYGZdq{}}\PYG{p}{,} \PYG{n+nx}{condition}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}incongruent\PYGZdq{}} \PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}} \PYG{n+nx}{colour}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}green\PYGZdq{}}\PYG{p}{,} \PYG{n+nx}{text}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}red\PYGZdq{}}\PYG{p}{,} \PYG{n+nx}{condition}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}incongruent\PYGZdq{}} \PYG{p}{\PYGZcb{}}
\PYG{p}{]}\PYG{p}{;}

\PYG{c+c1}{// these are in HTML, so \PYGZlt{}br\PYGZgt{} means \PYGZdq{}line break\PYGZdq{}}
\PYG{k+kd}{var} \PYG{n+nx}{instructions} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{n+nx}{type}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}instructions\PYGZsq{}}\PYG{p}{,}
    \PYG{n+nx}{pages}\PYG{o}{:} \PYG{p}{[}
      \PYG{l+s+s2}{\PYGZdq{}Welcome to the experiment.\PYGZlt{}br\PYGZgt{}Press Space to continue.\PYGZdq{}}\PYG{p}{,}
      \PYG{l+s+s2}{\PYGZdq{}In this experiment you will be presented with the words blue, red, yellow and green.\PYGZlt{}br\PYGZgt{}Press Space to continue.\PYGZdq{}}\PYG{p}{,}
      \PYG{l+s+s2}{\PYGZdq{}As soon as you see a new word, press its first letter.\PYGZlt{}br\PYGZgt{}For example, press the B key for blue.\PYGZlt{}br\PYGZgt{}Press Space to continue.\PYGZdq{}}\PYG{p}{,}
      \PYG{l+s+s2}{\PYGZdq{}Try to answer as quickly as you can!\PYGZlt{}br\PYGZgt{}Press Space to start the experiment.\PYGZdq{}}\PYG{p}{,}
    \PYG{p}{]}\PYG{p}{,}
    \PYG{n+nx}{key\PYGZus{}forward}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{} \PYGZsq{}}
\PYG{p}{\PYGZcb{}}

\PYG{k+kd}{var} \PYG{n+nx}{fixation} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{n+nx}{type}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}html\PYGZhy{}keyboard\PYGZhy{}response\PYGZsq{}}\PYG{p}{,}
    \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}+\PYGZsq{}}\PYG{p}{,}
    \PYG{n+nx}{trial\PYGZus{}duration}\PYG{o}{:} \PYG{l+m+mi}{500}\PYG{p}{,}
    \PYG{n+nx}{response\PYGZus{}ends\PYGZus{}trial}\PYG{o}{:} \PYG{k+kc}{false}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}

\PYG{c+c1}{// blank (ITI stands for \PYGZdq{}inter trial interval\PYGZdq{})}
\PYG{k+kd}{var} \PYG{n+nx}{iti} \PYG{o}{=} \PYG{p}{\PYGZob{}}
  \PYG{n+nx}{type}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}html\PYGZhy{}keyboard\PYGZhy{}response\PYGZsq{}}\PYG{p}{,}
  \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}\PYGZsq{}}\PYG{p}{,}
  \PYG{n+nx}{trial\PYGZus{}duration}\PYG{o}{:} \PYG{l+m+mi}{250}\PYG{p}{,}
  \PYG{n+nx}{response\PYGZus{}ends\PYGZus{}trial}\PYG{o}{:} \PYG{k+kc}{false}
\PYG{p}{\PYGZcb{}}

\PYG{k+kd}{var} \PYG{n+nx}{trial} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{n+nx}{type}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}html\PYGZhy{}keyboard\PYGZhy{}response\PYGZsq{}}\PYG{p}{,}
    \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{k+kd}{function} \PYG{p}{(}\PYG{p}{)} \PYG{p}{\PYGZob{}}
        \PYG{c+c1}{// note: the outer parentheses are only here so we can break the line}
        \PYG{k}{return} \PYG{p}{(}
             \PYG{l+s+s1}{\PYGZsq{}\PYGZlt{}p style=\PYGZdq{}color: \PYGZsq{}}\PYG{o}{+}\PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{timelineVariable}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}colour\PYGZdq{}}\PYG{p}{,} \PYG{k+kc}{true}\PYG{p}{)}\PYG{o}{+}\PYG{l+s+s1}{\PYGZsq{}\PYGZdq{}\PYGZgt{}\PYGZsq{}}
             \PYG{o}{+}\PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{timelineVariable}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}text\PYGZdq{}}\PYG{p}{,} \PYG{k+kc}{true}\PYG{p}{)}
             \PYG{o}{+}\PYG{l+s+s1}{\PYGZsq{}\PYGZlt{}/p\PYGZgt{}\PYGZsq{}}
        \PYG{p}{)}\PYG{p}{;}
    \PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{c+c1}{// \PYGZsq{}choices\PYGZsq{} restricts the available responses for the participant}
    \PYG{n+nx}{choices}\PYG{o}{:} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}r\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}g\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}b\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}y\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}
    \PYG{n+nx}{data}\PYG{o}{:} \PYG{p}{\PYGZob{}}
      \PYG{n+nx}{colour}\PYG{o}{:} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{timelineVariable}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}colour\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
      \PYG{n+nx}{text}\PYG{o}{:} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{timelineVariable}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}text\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
      \PYG{n+nx}{condition}\PYG{o}{:} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{timelineVariable}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}condition\PYGZsq{}}\PYG{p}{)}
    \PYG{p}{\PYGZcb{}}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}

\PYG{k+kd}{var} \PYG{n+nx}{trials\PYGZus{}with\PYGZus{}variables} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{n+nx}{timeline}\PYG{o}{:} \PYG{p}{[}\PYG{n+nx}{iti}\PYG{p}{,} \PYG{n+nx}{fixation}\PYG{p}{,} \PYG{n+nx}{trial}\PYG{p}{]}\PYG{p}{,}
    \PYG{n+nx}{timeline\PYGZus{}variables}\PYG{o}{:} \PYG{n+nx}{stroop\PYGZus{}variables}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}

\PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{init}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{n+nx}{timeline}\PYG{o}{:} \PYG{p}{[}\PYG{n+nx}{instructions}\PYG{p}{,} \PYG{n+nx}{trials\PYGZus{}with\PYGZus{}variables}\PYG{p}{]}\PYG{p}{,}
    \PYG{n+nx}{on\PYGZus{}finish}\PYG{o}{:} \PYG{k+kd}{function}\PYG{p}{(}\PYG{p}{)} \PYG{p}{\PYGZob{}}
        \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{data}\PYG{p}{.}\PYG{n+nx}{displayData}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}csv\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
    \PYG{p}{\PYGZcb{}}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}


\chapter{Stroop using a loop}
\label{\detokenize{stroop_loop:stroop-using-a-loop}}\label{\detokenize{stroop_loop:stroop-loop}}\label{\detokenize{stroop_loop::doc}}
Example \sphinxcode{\sphinxupquote{experiment.html}}. You may have to change this slightly
depending on the location of your copy of jsPsych on the server.

It contains some extra style information to make the background grey,
and make the text of the stimulus bigger and boldface.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+cp}{\PYGZlt{}!DOCTYPE html\PYGZgt{}}
\PYG{p}{\PYGZlt{}}\PYG{n+nt}{html}\PYG{p}{\PYGZgt{}}
\PYG{p}{\PYGZlt{}}\PYG{n+nt}{head}\PYG{p}{\PYGZgt{}}
    \PYG{p}{\PYGZlt{}}\PYG{n+nt}{title}\PYG{p}{\PYGZgt{}}My experiment\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{title}\PYG{p}{\PYGZgt{}}
    \PYG{p}{\PYGZlt{}}\PYG{n+nt}{script} \PYG{n+na}{src}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}jspsych\PYGZhy{}6.0/jspsych.js\PYGZdq{}}\PYG{p}{\PYGZgt{}}\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{script}\PYG{p}{\PYGZgt{}}
    \PYG{p}{\PYGZlt{}}\PYG{n+nt}{script} \PYG{n+na}{src}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}jspsych\PYGZhy{}6.0/plugins/jspsych\PYGZhy{}html\PYGZhy{}keyboard\PYGZhy{}response.js\PYGZdq{}}\PYG{p}{\PYGZgt{}}\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{script}\PYG{p}{\PYGZgt{}}
    \PYG{p}{\PYGZlt{}}\PYG{n+nt}{script} \PYG{n+na}{src}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}jspsych\PYGZhy{}6.0/plugins/jspsych\PYGZhy{}instructions.js\PYGZdq{}}\PYG{p}{\PYGZgt{}}\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{script}\PYG{p}{\PYGZgt{}}
    \PYG{p}{\PYGZlt{}}\PYG{n+nt}{link} \PYG{n+na}{href}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}jspsych\PYGZhy{}6.0/css/jspsych.css\PYGZdq{}} \PYG{n+na}{rel}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}stylesheet\PYGZdq{}} \PYG{n+na}{type}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}text/css\PYGZdq{}}\PYG{p}{\PYGZgt{}}\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{link}\PYG{p}{\PYGZgt{}}
    \PYG{p}{\PYGZlt{}}\PYG{n+nt}{script} \PYG{n+na}{src}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}experiment.js\PYGZdq{}}\PYG{p}{\PYGZgt{}}\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{script}\PYG{p}{\PYGZgt{}}
    \PYG{p}{\PYGZlt{}}\PYG{n+nt}{style}\PYG{p}{\PYGZgt{}}
      \PYG{n+nt}{body} \PYG{p}{\PYGZob{}}
        \PYG{k}{background\PYGZhy{}color}\PYG{p}{:} \PYG{l+m+mh}{\PYGZsh{}777777}\PYG{p}{;}
      \PYG{p}{\PYGZcb{}}
      \PYG{p}{.}\PYG{n+nc}{jspsych\PYGZhy{}display\PYGZhy{}element} \PYG{p}{\PYGZob{}}
         \PYG{k}{font\PYGZhy{}size}\PYG{p}{:} \PYG{k+kc}{xx\PYGZhy{}large}\PYG{p}{;}
         \PYG{k}{font\PYGZhy{}family}\PYG{p}{:} \PYG{n}{sans}\PYG{p}{;}
         \PYG{k}{font\PYGZhy{}weight}\PYG{p}{:} \PYG{k+kc}{bold}
      \PYG{p}{\PYGZcb{}}
    \PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{style}\PYG{p}{\PYGZgt{}}
\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{head}\PYG{p}{\PYGZgt{}}
\PYG{p}{\PYGZlt{}}\PYG{n+nt}{body}\PYG{p}{\PYGZgt{}}\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{body}\PYG{p}{\PYGZgt{}}
\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{html}\PYG{p}{\PYGZgt{}}
\end{sphinxVerbatim}

And \sphinxcode{\sphinxupquote{experiment.js}}:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kd}{var} \PYG{n+nx}{stroop\PYGZus{}variables} \PYG{o}{=} \PYG{p}{[}
  \PYG{p}{\PYGZob{}} \PYG{n+nx}{colour}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}blue\PYGZdq{}}\PYG{p}{,} \PYG{n+nx}{text}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}blue\PYGZdq{}}\PYG{p}{,} \PYG{n+nx}{condition}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}congruent\PYGZdq{}} \PYG{p}{\PYGZcb{}}\PYG{p}{,}
  \PYG{p}{\PYGZob{}} \PYG{n+nx}{colour}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}red\PYGZdq{}}\PYG{p}{,} \PYG{n+nx}{text}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}red\PYGZdq{}}\PYG{p}{,} \PYG{n+nx}{condition}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}congruent\PYGZdq{}} \PYG{p}{\PYGZcb{}}\PYG{p}{,}
  \PYG{p}{\PYGZob{}} \PYG{n+nx}{colour}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}yellow\PYGZdq{}}\PYG{p}{,} \PYG{n+nx}{text}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}yellow\PYGZdq{}}\PYG{p}{,} \PYG{n+nx}{condition}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}congruent\PYGZdq{}} \PYG{p}{\PYGZcb{}}\PYG{p}{,}
  \PYG{p}{\PYGZob{}} \PYG{n+nx}{colour}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}green\PYGZdq{}}\PYG{p}{,} \PYG{n+nx}{text}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}green\PYGZdq{}}\PYG{p}{,} \PYG{n+nx}{condition}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}congruent\PYGZdq{}} \PYG{p}{\PYGZcb{}}\PYG{p}{,}
  \PYG{p}{\PYGZob{}} \PYG{n+nx}{colour}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}blue\PYGZdq{}}\PYG{p}{,} \PYG{n+nx}{text}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}yellow\PYGZdq{}}\PYG{p}{,} \PYG{n+nx}{condition}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}incongruent\PYGZdq{}} \PYG{p}{\PYGZcb{}}\PYG{p}{,}
  \PYG{p}{\PYGZob{}} \PYG{n+nx}{colour}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}red\PYGZdq{}}\PYG{p}{,} \PYG{n+nx}{text}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}green\PYGZdq{}}\PYG{p}{,} \PYG{n+nx}{condition}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}incongruent\PYGZdq{}} \PYG{p}{\PYGZcb{}}\PYG{p}{,}
  \PYG{p}{\PYGZob{}} \PYG{n+nx}{colour}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}yellow\PYGZdq{}}\PYG{p}{,} \PYG{n+nx}{text}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}blue\PYGZdq{}}\PYG{p}{,} \PYG{n+nx}{condition}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}incongruent\PYGZdq{}} \PYG{p}{\PYGZcb{}}\PYG{p}{,}
  \PYG{p}{\PYGZob{}} \PYG{n+nx}{colour}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}green\PYGZdq{}}\PYG{p}{,} \PYG{n+nx}{text}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}red\PYGZdq{}}\PYG{p}{,} \PYG{n+nx}{condition}\PYG{o}{:} \PYG{l+s+s2}{\PYGZdq{}incongruent\PYGZdq{}} \PYG{p}{\PYGZcb{}}
\PYG{p}{]}\PYG{p}{;}

\PYG{c+c1}{// these are in HTML, so \PYGZlt{}br\PYGZgt{} means \PYGZdq{}line break\PYGZdq{}}
\PYG{k+kd}{var} \PYG{n+nx}{instructions} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{n+nx}{type}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}instructions\PYGZsq{}}\PYG{p}{,}
    \PYG{n+nx}{pages}\PYG{o}{:} \PYG{p}{[}
      \PYG{l+s+s2}{\PYGZdq{}Welcome to the experiment.\PYGZlt{}br\PYGZgt{}Press Space to continue.\PYGZdq{}}\PYG{p}{,}
      \PYG{l+s+s2}{\PYGZdq{}In this experiment you will be presented with the words blue, red, yellow and green.\PYGZlt{}br\PYGZgt{}Press Space to continue.\PYGZdq{}}\PYG{p}{,}
      \PYG{l+s+s2}{\PYGZdq{}As soon as you see a new word, press its first letter.\PYGZlt{}br\PYGZgt{}For example, press the B key for blue.\PYGZlt{}br\PYGZgt{}Press Space to continue.\PYGZdq{}}\PYG{p}{,}
      \PYG{l+s+s2}{\PYGZdq{}Try to answer as quickly as you can!\PYGZlt{}br\PYGZgt{}Press Space to start the experiment.\PYGZdq{}}\PYG{p}{,}
    \PYG{p}{]}\PYG{p}{,}
    \PYG{n+nx}{key\PYGZus{}forward}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{} \PYGZsq{}}
\PYG{p}{\PYGZcb{}}

\PYG{k+kd}{var} \PYG{n+nx}{fixation} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{n+nx}{type}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}html\PYGZhy{}keyboard\PYGZhy{}response\PYGZsq{}}\PYG{p}{,}
    \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}+\PYGZsq{}}\PYG{p}{,}
    \PYG{n+nx}{trial\PYGZus{}duration}\PYG{o}{:} \PYG{l+m+mi}{500}\PYG{p}{,}
    \PYG{n+nx}{response\PYGZus{}ends\PYGZus{}trial}\PYG{o}{:} \PYG{k+kc}{false}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}

\PYG{c+c1}{// blank (ITI stands for \PYGZdq{}inter trial interval\PYGZdq{})}
\PYG{k+kd}{var} \PYG{n+nx}{iti} \PYG{o}{=} \PYG{p}{\PYGZob{}}
  \PYG{n+nx}{type}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}html\PYGZhy{}keyboard\PYGZhy{}response\PYGZsq{}}\PYG{p}{,}
  \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}\PYGZsq{}}\PYG{p}{,}
  \PYG{n+nx}{trial\PYGZus{}duration}\PYG{o}{:} \PYG{l+m+mi}{250}\PYG{p}{,}
  \PYG{n+nx}{response\PYGZus{}ends\PYGZus{}trial}\PYG{o}{:} \PYG{k+kc}{false}
\PYG{p}{\PYGZcb{}}

\PYG{k+kd}{var} \PYG{n+nx}{trials} \PYG{o}{=} \PYG{p}{[}\PYG{n+nx}{instructions}\PYG{p}{]}\PYG{p}{;}
\PYG{k}{for} \PYG{p}{(}\PYG{k+kd}{var} \PYG{n+nx}{values} \PYG{k}{of} \PYG{n+nx}{stroop\PYGZus{}variables}\PYG{p}{)} \PYG{p}{\PYGZob{}}
    \PYG{c+c1}{// these two are always the same ....}
    \PYG{n+nx}{trials}\PYG{p}{.}\PYG{n+nx}{push}\PYG{p}{(}\PYG{n+nx}{iti}\PYG{p}{)}\PYG{p}{;}
    \PYG{n+nx}{trials}\PYG{p}{.}\PYG{n+nx}{push}\PYG{p}{(}\PYG{n+nx}{fixation}\PYG{p}{)}\PYG{p}{;}
    \PYG{c+c1}{// .... but the trial node will vary}
    \PYG{k+kd}{var} \PYG{n+nx}{trial} \PYG{o}{=} \PYG{p}{\PYGZob{}}
        \PYG{n+nx}{type}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}html\PYGZhy{}keyboard\PYGZhy{}response\PYGZsq{}}\PYG{p}{,}
        \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}\PYGZlt{}p style=\PYGZdq{}color: \PYGZsq{}}\PYG{o}{+}\PYG{n+nx}{values}\PYG{p}{.}\PYG{n+nx}{colour}\PYG{o}{+}\PYG{l+s+s1}{\PYGZsq{}\PYGZdq{}\PYGZgt{}\PYGZsq{}}\PYG{o}{+}\PYG{n+nx}{values}\PYG{p}{.}\PYG{n+nx}{text}\PYG{o}{+}\PYG{l+s+s1}{\PYGZsq{}\PYGZlt{}/p\PYGZgt{}\PYGZsq{}}\PYG{p}{,}
        \PYG{c+c1}{// \PYGZsq{}choices\PYGZsq{} restricts the available responses for the participant}
        \PYG{n+nx}{choices}\PYG{o}{:} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}r\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}g\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}b\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}y\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}
        \PYG{n+nx}{data}\PYG{o}{:} \PYG{n+nx}{values}
    \PYG{p}{\PYGZcb{}}\PYG{p}{;}
    \PYG{n+nx}{trials}\PYG{p}{.}\PYG{n+nx}{push}\PYG{p}{(}\PYG{n+nx}{trial}\PYG{p}{)}\PYG{p}{;}
\PYG{p}{\PYGZcb{}}

\PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{init}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{n+nx}{timeline}\PYG{o}{:} \PYG{n+nx}{trials}\PYG{p}{,}
    \PYG{n+nx}{on\PYGZus{}finish}\PYG{o}{:} \PYG{k+kd}{function}\PYG{p}{(}\PYG{p}{)} \PYG{p}{\PYGZob{}}
        \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{data}\PYG{p}{.}\PYG{n+nx}{displayData}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}csv\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
    \PYG{p}{\PYGZcb{}}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}


\chapter{Stroop with functions}
\label{\detokenize{stroop_functions:stroop-with-functions}}\label{\detokenize{stroop_functions:stroop-functions}}\label{\detokenize{stroop_functions::doc}}
Example \sphinxcode{\sphinxupquote{experiment.html}}. You may have to change this slightly
depending on the location of your copy of jsPsych on the server.

It contains some extra style information to make the background grey,
and make the text of the stimulus bigger and boldface.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+cp}{\PYGZlt{}!DOCTYPE html\PYGZgt{}}
\PYG{p}{\PYGZlt{}}\PYG{n+nt}{html}\PYG{p}{\PYGZgt{}}
\PYG{p}{\PYGZlt{}}\PYG{n+nt}{head}\PYG{p}{\PYGZgt{}}
    \PYG{p}{\PYGZlt{}}\PYG{n+nt}{title}\PYG{p}{\PYGZgt{}}My experiment\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{title}\PYG{p}{\PYGZgt{}}
    \PYG{p}{\PYGZlt{}}\PYG{n+nt}{script} \PYG{n+na}{src}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}jspsych\PYGZhy{}6.0/jspsych.js\PYGZdq{}}\PYG{p}{\PYGZgt{}}\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{script}\PYG{p}{\PYGZgt{}}
    \PYG{p}{\PYGZlt{}}\PYG{n+nt}{script} \PYG{n+na}{src}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}jspsych\PYGZhy{}6.0/plugins/jspsych\PYGZhy{}html\PYGZhy{}keyboard\PYGZhy{}response.js\PYGZdq{}}\PYG{p}{\PYGZgt{}}\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{script}\PYG{p}{\PYGZgt{}}
    \PYG{p}{\PYGZlt{}}\PYG{n+nt}{script} \PYG{n+na}{src}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}jspsych\PYGZhy{}6.0/plugins/jspsych\PYGZhy{}instructions.js\PYGZdq{}}\PYG{p}{\PYGZgt{}}\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{script}\PYG{p}{\PYGZgt{}}
    \PYG{p}{\PYGZlt{}}\PYG{n+nt}{link} \PYG{n+na}{href}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}jspsych\PYGZhy{}6.0/css/jspsych.css\PYGZdq{}} \PYG{n+na}{rel}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}stylesheet\PYGZdq{}} \PYG{n+na}{type}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}text/css\PYGZdq{}}\PYG{p}{\PYGZgt{}}\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{link}\PYG{p}{\PYGZgt{}}
    \PYG{p}{\PYGZlt{}}\PYG{n+nt}{script} \PYG{n+na}{src}\PYG{o}{=}\PYG{l+s}{\PYGZdq{}experiment.js\PYGZdq{}}\PYG{p}{\PYGZgt{}}\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{script}\PYG{p}{\PYGZgt{}}
    \PYG{p}{\PYGZlt{}}\PYG{n+nt}{style}\PYG{p}{\PYGZgt{}}
      \PYG{n+nt}{body} \PYG{p}{\PYGZob{}}
        \PYG{k}{background\PYGZhy{}color}\PYG{p}{:} \PYG{l+m+mh}{\PYGZsh{}777777}\PYG{p}{;}
      \PYG{p}{\PYGZcb{}}
      \PYG{p}{.}\PYG{n+nc}{jspsych\PYGZhy{}display\PYGZhy{}element} \PYG{p}{\PYGZob{}}
         \PYG{k}{font\PYGZhy{}size}\PYG{p}{:} \PYG{k+kc}{xx\PYGZhy{}large}\PYG{p}{;}
         \PYG{k}{font\PYGZhy{}family}\PYG{p}{:} \PYG{n}{sans}\PYG{p}{;}
         \PYG{k}{font\PYGZhy{}weight}\PYG{p}{:} \PYG{k+kc}{bold}
      \PYG{p}{\PYGZcb{}}
    \PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{style}\PYG{p}{\PYGZgt{}}
\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{head}\PYG{p}{\PYGZgt{}}
\PYG{p}{\PYGZlt{}}\PYG{n+nt}{body}\PYG{p}{\PYGZgt{}}\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{body}\PYG{p}{\PYGZgt{}}
\PYG{p}{\PYGZlt{}}\PYG{p}{/}\PYG{n+nt}{html}\PYG{p}{\PYGZgt{}}
\end{sphinxVerbatim}

And \sphinxcode{\sphinxupquote{experiment.js}}:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{// the colours are also the words ....}
\PYG{k+kd}{var} \PYG{n+nx}{colours} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}red\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}green\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}blue\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}yellow\PYGZsq{}}\PYG{p}{]}\PYG{p}{;}

\PYG{k+kd}{var} \PYG{n+nx}{n\PYGZus{}trials} \PYG{o}{=} \PYG{l+m+mi}{30}\PYG{p}{;}

\PYG{c+c1}{// returns a JavaScript object with \PYGZob{} text: ...., colour: .... \PYGZcb{}}
\PYG{c+c1}{// using a random colour (text is the same as colour)}
\PYG{k+kd}{function} \PYG{n+nx}{congruent}\PYG{p}{(}\PYG{p}{)} \PYG{p}{\PYGZob{}}
    \PYG{c+c1}{// pick a colour ....}
    \PYG{c+c1}{// (when we\PYGZsq{}re only picking one, with/without replacement doesn\PYGZsq{}t matter)}
    \PYG{k+kd}{var} \PYG{n+nx}{colour\PYGZus{}list} \PYG{o}{=} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{randomization}\PYG{p}{.}\PYG{n+nx}{sampleWithReplacement}\PYG{p}{(}\PYG{n+nx}{colours}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{;}
    \PYG{c+c1}{// this returns a list with one item, so we select the first (only) item}
    \PYG{k}{return} \PYG{p}{\PYGZob{}} \PYG{n+nx}{text}\PYG{o}{:} \PYG{n+nx}{colour\PYGZus{}list}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n+nx}{colour}\PYG{o}{:} \PYG{n+nx}{colour\PYGZus{}list}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n+nx}{condition}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}congruent\PYGZsq{}} \PYG{p}{\PYGZcb{}}\PYG{p}{;}
\PYG{p}{\PYGZcb{}}

\PYG{c+c1}{// returns a JavaScript object with \PYGZob{} text: ...., colour: .... \PYGZcb{}}
\PYG{c+c1}{// using a random colour (text is different to colour)}
\PYG{k+kd}{function} \PYG{n+nx}{incongruent}\PYG{p}{(}\PYG{p}{)} \PYG{p}{\PYGZob{}}
    \PYG{c+c1}{// pick two colours without replacement (i.e. they will be different)}
    \PYG{k+kd}{var} \PYG{n+nx}{colour\PYGZus{}list} \PYG{o}{=} \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{randomization}\PYG{p}{.}\PYG{n+nx}{sampleWithoutReplacement}\PYG{p}{(}\PYG{n+nx}{colours}\PYG{p}{,}\PYG{l+m+mi}{2}\PYG{p}{)}\PYG{p}{;}
    \PYG{c+c1}{// this returns a list with two item, we select these out}
    \PYG{k}{return} \PYG{p}{\PYGZob{}} \PYG{n+nx}{text}\PYG{o}{:} \PYG{n+nx}{colour\PYGZus{}list}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n+nx}{colour}\PYG{o}{:} \PYG{n+nx}{colour\PYGZus{}list}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,} \PYG{n+nx}{condition}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}incongruent\PYGZsq{}} \PYG{p}{\PYGZcb{}}\PYG{p}{;}
\PYG{p}{\PYGZcb{}}

\PYG{c+c1}{// these are in HTML, so \PYGZlt{}br\PYGZgt{} means \PYGZdq{}line break\PYGZdq{}}
\PYG{k+kd}{var} \PYG{n+nx}{instructions} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{n+nx}{type}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}instructions\PYGZsq{}}\PYG{p}{,}
    \PYG{n+nx}{pages}\PYG{o}{:} \PYG{p}{[}
      \PYG{l+s+s2}{\PYGZdq{}Welcome to the experiment.\PYGZlt{}br\PYGZgt{}Press Space to continue.\PYGZdq{}}\PYG{p}{,}
      \PYG{l+s+s2}{\PYGZdq{}In this experiment you will be presented with the words blue, red, yellow and green.\PYGZlt{}br\PYGZgt{}Press Space to continue.\PYGZdq{}}\PYG{p}{,}
      \PYG{l+s+s2}{\PYGZdq{}As soon as you see a new word, press its first letter.\PYGZlt{}br\PYGZgt{}For example, press the B key for blue.\PYGZlt{}br\PYGZgt{}Press Space to continue.\PYGZdq{}}\PYG{p}{,}
      \PYG{l+s+s2}{\PYGZdq{}Try to answer as quickly as you can!\PYGZlt{}br\PYGZgt{}Press Space to start the experiment.\PYGZdq{}}\PYG{p}{,}
    \PYG{p}{]}\PYG{p}{,}
    \PYG{n+nx}{key\PYGZus{}forward}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{} \PYGZsq{}}
\PYG{p}{\PYGZcb{}}

\PYG{k+kd}{var} \PYG{n+nx}{fixation} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{n+nx}{type}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}html\PYGZhy{}keyboard\PYGZhy{}response\PYGZsq{}}\PYG{p}{,}
    \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}+\PYGZsq{}}\PYG{p}{,}
    \PYG{n+nx}{trial\PYGZus{}duration}\PYG{o}{:} \PYG{l+m+mi}{500}\PYG{p}{,}
    \PYG{n+nx}{response\PYGZus{}ends\PYGZus{}trial}\PYG{o}{:} \PYG{k+kc}{false}
\PYG{p}{\PYGZcb{}}\PYG{p}{;}

\PYG{c+c1}{// blank (ITI stands for \PYGZdq{}inter trial interval\PYGZdq{})}
\PYG{k+kd}{var} \PYG{n+nx}{iti} \PYG{o}{=} \PYG{p}{\PYGZob{}}
  \PYG{n+nx}{type}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}html\PYGZhy{}keyboard\PYGZhy{}response\PYGZsq{}}\PYG{p}{,}
  \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}\PYGZsq{}}\PYG{p}{,}
  \PYG{n+nx}{trial\PYGZus{}duration}\PYG{o}{:} \PYG{l+m+mi}{250}\PYG{p}{,}
  \PYG{n+nx}{response\PYGZus{}ends\PYGZus{}trial}\PYG{o}{:} \PYG{k+kc}{false}
\PYG{p}{\PYGZcb{}}

\PYG{k+kd}{var} \PYG{n+nx}{trials} \PYG{o}{=} \PYG{p}{[}\PYG{n+nx}{instructions}\PYG{p}{]}\PYG{p}{;}
\PYG{c+c1}{// repeat this code n\PYGZus{}trials times}
\PYG{k}{for} \PYG{p}{(}\PYG{k+kd}{var} \PYG{n+nx}{i}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{;} \PYG{n+nx}{i}\PYG{o}{\PYGZlt{}}\PYG{n+nx}{n\PYGZus{}trials}\PYG{p}{;} \PYG{n+nx}{i}\PYG{o}{++}\PYG{p}{)} \PYG{p}{\PYGZob{}}
    \PYG{k+kd}{var} \PYG{n+nx}{values}\PYG{p}{;}
    \PYG{c+c1}{// Math.random returns a random number between 0 and 1. Use this to decide}
    \PYG{c+c1}{// whether the current trial is congruent or incongruent.}
    \PYG{k}{if} \PYG{p}{(}\PYG{n+nb}{Math}\PYG{p}{.}\PYG{n+nx}{random}\PYG{p}{(}\PYG{p}{)} \PYG{o}{\PYGZlt{}} \PYG{l+m+mf}{0.5}\PYG{p}{)} \PYG{p}{\PYGZob{}}
        \PYG{n+nx}{values} \PYG{o}{=} \PYG{n+nx}{congruent}\PYG{p}{(}\PYG{p}{)}\PYG{p}{;}
    \PYG{p}{\PYGZcb{}} \PYG{k}{else} \PYG{p}{\PYGZob{}}
        \PYG{n+nx}{values} \PYG{o}{=} \PYG{n+nx}{incongruent}\PYG{p}{(}\PYG{p}{)}\PYG{p}{;}
    \PYG{p}{\PYGZcb{}}
    \PYG{k+kd}{var} \PYG{n+nx}{trial} \PYG{o}{=} \PYG{p}{\PYGZob{}}
        \PYG{n+nx}{type}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}html\PYGZhy{}keyboard\PYGZhy{}response\PYGZsq{}}\PYG{p}{,}
        \PYG{n+nx}{stimulus}\PYG{o}{:} \PYG{l+s+s1}{\PYGZsq{}\PYGZlt{}p style=\PYGZdq{}color: \PYGZsq{}}\PYG{o}{+}\PYG{n+nx}{values}\PYG{p}{.}\PYG{n+nx}{colour}\PYG{o}{+}\PYG{l+s+s1}{\PYGZsq{}\PYGZdq{}\PYGZgt{}\PYGZsq{}}\PYG{o}{+}\PYG{n+nx}{values}\PYG{p}{.}\PYG{n+nx}{text}\PYG{o}{+}\PYG{l+s+s1}{\PYGZsq{}\PYGZlt{}/p\PYGZgt{}\PYGZsq{}}\PYG{p}{,}
        \PYG{c+c1}{// \PYGZsq{}choices\PYGZsq{} restricts the available responses for the participant}
        \PYG{n+nx}{choices}\PYG{o}{:} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}r\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}g\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}b\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}y\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}
        \PYG{n+nx}{data}\PYG{o}{:} \PYG{n+nx}{values}
    \PYG{p}{\PYGZcb{}}\PYG{p}{;}
    \PYG{n+nx}{trials}\PYG{p}{.}\PYG{n+nx}{push}\PYG{p}{(}\PYG{n+nx}{iti}\PYG{p}{)}\PYG{p}{;}
    \PYG{n+nx}{trials}\PYG{p}{.}\PYG{n+nx}{push}\PYG{p}{(}\PYG{n+nx}{fixation}\PYG{p}{)}\PYG{p}{;}
    \PYG{n+nx}{trials}\PYG{p}{.}\PYG{n+nx}{push}\PYG{p}{(}\PYG{n+nx}{trial}\PYG{p}{)}\PYG{p}{;}
\PYG{p}{\PYGZcb{}}

\PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{init}\PYG{p}{(}\PYG{p}{\PYGZob{}}
    \PYG{n+nx}{timeline}\PYG{o}{:} \PYG{n+nx}{trials}\PYG{p}{,}
    \PYG{n+nx}{on\PYGZus{}finish}\PYG{o}{:} \PYG{k+kd}{function}\PYG{p}{(}\PYG{p}{)} \PYG{p}{\PYGZob{}}
        \PYG{n+nx}{jsPsych}\PYG{p}{.}\PYG{n+nx}{data}\PYG{p}{.}\PYG{n+nx}{displayData}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}csv\PYGZsq{}}\PYG{p}{)}\PYG{p}{;}
    \PYG{p}{\PYGZcb{}}
\PYG{p}{\PYGZcb{}}\PYG{p}{)}\PYG{p}{;}
\end{sphinxVerbatim}
\begin{itemize}
\item {} 
\DUrole{xref,std,std-ref}{search}

\end{itemize}



\renewcommand{\indexname}{Index}
\printindex
\end{document}